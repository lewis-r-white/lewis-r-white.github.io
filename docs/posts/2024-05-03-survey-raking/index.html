<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Lewis White">
<meta name="dcterms.date" content="2024-05-03">
<meta name="description" content="Employing raking, also known as iterative proportional fitting, to refine survey weights and better align results with known population values.">

<title>lewis-r-white.github.io - Raking to Improve Survey Weights</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="../../site_libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="../../site_libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet">
<script src="../../site_libs/datatables-binding-0.27/datatables.js"></script>
<script src="../../site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.min.css" rel="stylesheet">
<link href="../../site_libs/dt-core-1.12.1/css/jquery.dataTables.extra.css" rel="stylesheet">
<script src="../../site_libs/dt-core-1.12.1/js/jquery.dataTables.min.js"></script>
<link href="../../site_libs/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet">
<script src="../../site_libs/crosstalk-1.2.0/js/crosstalk.min.js"></script>


</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top quarto-banner">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="../../index.html">
    <span class="navbar-title">lewis-r-white.github.io</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="../../index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../about.html"> 
<span class="menu-text">Bio</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../Posts.html"> 
<span class="menu-text">Blog Posts</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../../resume.pdf"> 
<span class="menu-text">Resume</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<header id="title-block-header" class="quarto-title-block default page-columns page-full">
  <div class="quarto-title-banner page-columns page-full">
    <div class="quarto-title column-body">
      <h1 class="title">Raking to Improve Survey Weights</h1>
                  <div>
        <div class="description">
          Employing raking, also known as iterative proportional fitting, to refine survey weights and better align results with known population values.
        </div>
      </div>
                          <div class="quarto-categories">
                <div class="quarto-category">Columbia University</div>
                <div class="quarto-category">R</div>
                <div class="quarto-category">Survey</div>
              </div>
                  </div>
  </div>
    
  <div class="quarto-title-meta-author">
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-heading">Affiliation</div>
    
      <div class="quarto-title-meta-contents">
      <p class="author"><a href="https://lewis-r-white.github.io/">Lewis White</a> </p>
    </div>
    <div class="quarto-title-meta-contents">
          <p class="affiliation">
              Columbia University, Mailman School of Public Health
            </p>
        </div>
    </div>

  <div class="quarto-title-meta">

        
      <div>
      <div class="quarto-title-meta-heading">Published</div>
      <div class="quarto-title-meta-contents">
        <p class="date">May 3, 2024</p>
      </div>
    </div>
    
      
    </div>
    
  
  </header><div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction-the-need-for-survey-weights" id="toc-introduction-the-need-for-survey-weights" class="nav-link active" data-scroll-target="#introduction-the-need-for-survey-weights">Introduction: The Need for Survey Weights</a></li>
  <li><a href="#an-overview-of-the-raking-methodology-for-survey-weights" id="toc-an-overview-of-the-raking-methodology-for-survey-weights" class="nav-link" data-scroll-target="#an-overview-of-the-raking-methodology-for-survey-weights">An Overview of the Raking Methodology for Survey Weights</a></li>
  <li><a href="#simple-raking-example" id="toc-simple-raking-example" class="nav-link" data-scroll-target="#simple-raking-example">Simple Raking Example</a>
  <ul class="collapse">
  <li><a href="#raking-steps" id="toc-raking-steps" class="nav-link" data-scroll-target="#raking-steps">Raking steps:</a></li>
  <li><a href="#simple-raking-example-1" id="toc-simple-raking-example-1" class="nav-link" data-scroll-target="#simple-raking-example-1">Simple Raking Example</a></li>
  </ul></li>
  <li><a href="#case-study-raking-to-improve-representativeness-in-national-household-survey" id="toc-case-study-raking-to-improve-representativeness-in-national-household-survey" class="nav-link" data-scroll-target="#case-study-raking-to-improve-representativeness-in-national-household-survey">Case Study: Raking to Improve Representativeness in National Household Survey</a>
  <ul class="collapse">
  <li><a href="#background" id="toc-background" class="nav-link" data-scroll-target="#background">Background:</a></li>
  <li><a href="#set-up" id="toc-set-up" class="nav-link" data-scroll-target="#set-up">Set Up:</a>
  <ul class="collapse">
  <li><a href="#setting-up-the-population-totals-for-raking" id="toc-setting-up-the-population-totals-for-raking" class="nav-link" data-scroll-target="#setting-up-the-population-totals-for-raking">Setting up the Population Totals for Raking</a></li>
  <li><a href="#specifying-the-survey-design-using-rake-for-each-of-the-models" id="toc-specifying-the-survey-design-using-rake-for-each-of-the-models" class="nav-link" data-scroll-target="#specifying-the-survey-design-using-rake-for-each-of-the-models">Specifying the Survey Design (using <code>Rake()</code>) for Each of the Models</a></li>
  <li><a href="#calculating-the-survey-statistics-for-each-model" id="toc-calculating-the-survey-statistics-for-each-model" class="nav-link" data-scroll-target="#calculating-the-survey-statistics-for-each-model">Calculating the Survey Statistics for Each Model</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">Results</a></li>
  <li><a href="#conclusions" id="toc-conclusions" class="nav-link" data-scroll-target="#conclusions">Conclusions</a></li>
  <li><a href="#sensitivity-analysis-grouping-variations" id="toc-sensitivity-analysis-grouping-variations" class="nav-link" data-scroll-target="#sensitivity-analysis-grouping-variations">Sensitivity Analysis: Grouping Variations</a></li>
  <li><a href="#sensitivity-analysis-results" id="toc-sensitivity-analysis-results" class="nav-link" data-scroll-target="#sensitivity-analysis-results">Sensitivity Analysis: Results</a></li>
  </ul></li>
  <li><a href="#bibliography" id="toc-bibliography" class="nav-link" data-scroll-target="#bibliography">Bibliography:</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content quarto-banner-title-block" id="quarto-document-content">





<section id="introduction-the-need-for-survey-weights" class="level1">
<h1>Introduction: The Need for Survey Weights</h1>
<p>Surveys are an essential tool for gathering information and understanding public opinion on various issues. The success of survey-based research largely depends on the sampling procedure used. When sampling units do not have equal probabilities of selection, survey weights become crucial to ensure that statistics derived from the sample accurately represent the target population.</p>
<p>Typically, a survey weight for each unit is calculated as the inverse of its probability of being selected. In a simple random sample, this would be 1/N, where N is the total population size, making the weight uniform across all units. However, more complex survey designs—such as stratified, clustered, or multistage sampling—require different weights since each unit may represent varying numbers of people from the target population.</p>
<p>Even with accurately calculated initial weights, the sample might not perfectly reflect the population due to the inherent randomness of sampling, or factors like non-response or coverage biases. To address these discrepancies, sample weights can be adjusted to better align with known population totals. This process, known as sample balancing, will be further explored with a focus on a specific technique called ‘raking’ in the next section.</p>
</section>
<section id="an-overview-of-the-raking-methodology-for-survey-weights" class="level1">
<h1>An Overview of the Raking Methodology for Survey Weights</h1>
<p>Raking, also known as iterative proportional fitting, is a post stratification procedure that can be used to adjust survey weights to better align with known population totals. It is most commonly used to account for non-response and non-coverage biases, but can account for a range of biases in the design and implementation of a survey. Raking enhances the representativeness and accuracy of survey results, assuming accurate population totals.</p>
<p>Here are some commonly recommended ‘best practices’ for raking:</p>
<p><strong>Base weights:</strong></p>
<ul>
<li>Starting with base weights, initial weights based on the inverse probability of selection, is a standard approach (Battaglia et al., 2009).</li>
</ul>
<p><strong>Variable selection:</strong></p>
<ul>
<li>Choosing relevant variables is critical. Typically, these include demographic information and key survey topics. For instance, political affiliation might be used for a survey on public policy opinions (Pew Research Center, 2018).</li>
</ul>
<p><strong>Collapse small cells:</strong></p>
<ul>
<li>It is recommended to merge smaller categories that represent less than 2% of the sample or control totals to prevent issues with convergence and prevent overfitting (Battaglia et al., 2009)(Oh and Scheuren, 1978).</li>
</ul>
<p><strong>Weight trimming:</strong></p>
<ul>
<li>Limiting the number of iterations and trimming outlier weights helps prevent overfitting. Weights significantly larger than average (e.g.&nbsp;5x) should be truncated to maintain balance (Battaglia et al., 2004)</li>
</ul>
<p><strong>Model evaluation:</strong></p>
<ul>
<li><p>Often, demographic discrepancies exceeding 5 percentage points are “notable” and discrepancies less than 2 percentage points are not. Discrepancies in the 2 to 5 point range may be notable if the characteristic is of special interest for the study or is strongly associated with key outcome variables (Debell &amp; Krosnick, 2009)</p></li>
<li><p>It’s best to examine the effects of raking on variables not used as raking factors. If these estimates show a greater difference from the benchmarks using the new weights, consider raking with a revised poststratification approach (Debell &amp; Krosnick, 2009)</p></li>
</ul>
<p>The following section will outline the raking algorithm and walk through a simple demonstration of how the raking process can be used to improve alignment with known population values.</p>
</section>
<section id="simple-raking-example" class="level1">
<h1>Simple Raking Example</h1>
<p>This section provides a high level description of the raking algorithm and then walks through a simple example using two binary variables to illustrate the raking process.</p>
<section id="raking-steps" class="level2">
<h2 class="anchored" data-anchor-id="raking-steps">Raking steps:</h2>
<ol type="1">
<li>Take each row in turn and multiply each entry in the row by the ratio of the population total to the weighted sample total for that category
<ul>
<li>The row totals of the adjusted data should agree with the population totals for that variable. The weighted column totals of the adjusted data, however, may not yet agree with the population totals for the column variable.</li>
</ul></li>
<li>Take each column and multiply each entry in the column by the ratio of the population total to the current total for that category.
<ul>
<li>Now the weighted column totals of the adjusted data agree with the population totals for that variable, but the new weighted row totals may no longer match the corresponding population totals.</li>
</ul></li>
<li>Continue alternating between the rows and the columns.
<ul>
<li>Close agreement on both rows and columns is usually achieved after a small number of iterations.</li>
</ul></li>
<li>The result is a tabulation for the population that reflects the relation of the two control variables in the sample.</li>
<li>Raking can also adjust a set of data to control totals on three or more variables. In such situations the control totals often involve single variables, but they may involve two or more variables.</li>
</ol>
</section>
<section id="simple-raking-example-1" class="level2">
<h2 class="anchored" data-anchor-id="simple-raking-example-1">Simple Raking Example</h2>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Child</th>
<th>Adult</th>
<th>Row Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Urban</strong></td>
<td>30</td>
<td>20</td>
<td>50</td>
</tr>
<tr class="even">
<td><strong>Rural</strong></td>
<td>20</td>
<td>30</td>
<td>50</td>
</tr>
<tr class="odd">
<td><strong>Column Total</strong></td>
<td>50</td>
<td>50</td>
<td>100</td>
</tr>
</tbody>
</table>
<p><strong>Desired population totals:</strong></p>
<ul>
<li><p>Urban: 60, Rural: 40</p></li>
<li><p>Child: 40, Adult: 60<br>
</p></li>
</ul>
<p><strong>Adjusting the rows first to match the locality population totals:</strong></p>
<ul>
<li><p>Urban adjustment ratio: 60 / 50 = 1.2</p></li>
<li><p>Rural adjustment ratio: 40 / 50 = 0.8</p></li>
</ul>
<p><strong>Adjusted rows:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Child</th>
<th>Adult</th>
<th>Row Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Urban</strong></td>
<td>36</td>
<td>24</td>
<td>60</td>
</tr>
<tr class="even">
<td><strong>Rural</strong></td>
<td>16</td>
<td>24</td>
<td>40</td>
</tr>
<tr class="odd">
<td><strong>Column Total</strong></td>
<td>52</td>
<td>48</td>
<td>100</td>
</tr>
</tbody>
</table>
<p>Now, the row totals match the population totals for locality. However, the column totals for age groups are still off.</p>
<p><strong>Adjusting columns to match the age group population totals:</strong></p>
<ul>
<li><p>Child adjustment ratio: 40 / 52 ≈ 0.7692</p></li>
<li><p>Adult adjustment ratio: 60 / 48 = 1.25</p></li>
</ul>
<p><strong>Adjusted columns:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Child</th>
<th>Adult</th>
<th>Row Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Urban</strong></td>
<td>27.69</td>
<td>30</td>
<td>57.69</td>
</tr>
<tr class="even">
<td><strong>Rural</strong></td>
<td>12.31</td>
<td>30</td>
<td>42.31</td>
</tr>
<tr class="odd">
<td><strong>Column Total</strong></td>
<td>40</td>
<td>60</td>
<td>100</td>
</tr>
</tbody>
</table>
<p>&nbsp;</p>
<p><strong>Readjusting the rows to match the locality population totals:</strong></p>
<ul>
<li><p>Urban adjustment ratio: 60 / 57.69 = 1.04</p></li>
<li><p>Rural adjustment ratio: 40 / 42.31 = 0.945</p></li>
</ul>
<p><strong>Adjusted rows:</strong></p>
<table class="table">
<thead>
<tr class="header">
<th></th>
<th>Child</th>
<th>Adult</th>
<th>Row Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>Urban</strong></td>
<td>28.80</td>
<td>31.20</td>
<td>60</td>
</tr>
<tr class="even">
<td><strong>Rural</strong></td>
<td>11.61</td>
<td>28.36</td>
<td>40</td>
</tr>
<tr class="odd">
<td><strong>Column Total</strong></td>
<td>40.44</td>
<td>59.56</td>
<td>100</td>
</tr>
</tbody>
</table>
<p><strong>Readjusting the columns to match the age population totals:</strong></p>
<ul>
<li><p>Child adjustment ratio: 40 / 40.44 = 0.989</p></li>
<li><p>Adult adjustment ratio: 60 / 59.56 = 1.007</p></li>
</ul>
<table class="table">
<tbody>
<tr class="odd">
<td></td>
<td><strong>Child</strong></td>
<td><strong>Adult</strong></td>
<td><strong>Row Total</strong></td>
</tr>
<tr class="even">
<td><strong>Urban</strong></td>
<td>28.49</td>
<td>31.43</td>
<td>59.92</td>
</tr>
<tr class="odd">
<td><strong>Rural</strong></td>
<td>11.51</td>
<td>28.57</td>
<td>40.08</td>
</tr>
<tr class="even">
<td><strong>Column Total</strong></td>
<td>40</td>
<td>60</td>
<td>100</td>
</tr>
</tbody>
</table>
<p>At a certain point, the algorithm determines that the marginal populations are “close enough” to the target population — this is convergence. You are able to specify the convergence criterion when setting up the raking procedure. One simple definition of convergence requires that each marginal total of the raked weights be within a specified tolerance of the corresponding control total. In the rake() function in R, convergence is reached if the maximum change in a table entry is less than epsilon (default = 1).</p>
<p>It is harder to visualize when raking on more variables, but the process is the same. You continue making adjustments until the marginal sample populations are “close enough” to the target.</p>
</section>
</section>
<section id="case-study-raking-to-improve-representativeness-in-national-household-survey" class="level1">
<h1>Case Study: Raking to Improve Representativeness in National Household Survey</h1>
<section id="background" class="level2">
<h2 class="anchored" data-anchor-id="background">Background:</h2>
<p>As part of the Combating Household Air Pollution (CHAP) project, we applied raking to a national household survey on fuel use in Ghana. The CHAP project is a collaborative effort from several research institutions: Columbia University, UC Santa Barbara, and the Kintampo Health Research Center in Ghana. For the fuel survey, we also partnered with the Ghana Statistical Service to conduct the sampling and interviews.</p>
<p>The CHAP survey employed a multistage, cluster approach to the sample. A total of 370 enumeration areas (EAs) and 20 households within each EA were sampled for a total sample size of 7,400 households. Ghana’s 16 regions were used for stratification, as well as the classification of an EA as either urban or rural.</p>
<p>Initial survey weights were calculated based on the probability of selecting an EA and a household within it. Discrepancies between our survey results and the census data from the Ghana Statistical Services (GSS) prompted us to employ raking to refine our weights.</p>
</section>
<section id="set-up" class="level2">
<h2 class="anchored" data-anchor-id="set-up">Set Up:</h2>
<p>We tested various raking models using the survey package in R, starting with base weights and adjusting for different sets of variables. To address issues with small cell sizes, regional data was consolidated into larger groupings. The process and rationale for these adjustments are detailed below.</p>
<table class="table">
<caption>y* indicates that the measurement is obtained through the regional cross distribution.</caption>
<thead>
<tr class="header">
<th>Stat</th>
<th>Rake 1</th>
<th>Rake 2</th>
<th>Rake 3</th>
<th>Rake 4</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Total urban/rural households</td>
<td>y</td>
<td>y*</td>
<td>y</td>
<td>y*</td>
</tr>
<tr class="even">
<td>Total households in each region</td>
<td>y</td>
<td>y*</td>
<td>y</td>
<td>y</td>
</tr>
<tr class="odd">
<td>Regional urban/rural households</td>
<td></td>
<td>y</td>
<td></td>
<td>y</td>
</tr>
<tr class="even">
<td>Total primary fuel source</td>
<td></td>
<td></td>
<td>y</td>
<td>y*</td>
</tr>
<tr class="odd">
<td>Regional primary fuel source</td>
<td></td>
<td></td>
<td></td>
<td>y</td>
</tr>
</tbody>
</table>
<p>Expand the code blocks below to examine how we set up the raking procedure and complete raking for each of these models.</p>
<section id="setting-up-the-population-totals-for-raking" class="level3">
<h3 class="anchored" data-anchor-id="setting-up-the-population-totals-for-raking">Setting up the Population Totals for Raking</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="do">### urban/rural total</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>pop.urban_rural_str <span class="ot">&lt;-</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban_rural_str =</span> <span class="fu">c</span>(<span class="st">"urban"</span>, <span class="st">"rural"</span>),</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">Freq =</span> <span class="fu">c</span>(</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>      <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_urban,</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>      <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_rural</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a><span class="do">### primary fuel categories </span></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>hh_pop_tot <span class="ot">&lt;-</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>frac_lpg <span class="ot">&lt;-</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>fuel_lpg <span class="sc">/</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>frac_char <span class="ot">&lt;-</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>fuel_char <span class="sc">/</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>frac_wood <span class="ot">&lt;-</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>fuel_wood <span class="sc">/</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>pop.primary_fuel <span class="ot">&lt;-</span></span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">data.frame</span>(</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">collapsed_fuel =</span> <span class="fu">c</span>(<span class="st">"none_other"</span>, <span class="st">"wood"</span>, <span class="st">"LPG"</span>, <span class="st">"charcoal"</span>),</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">Freq =</span> <span class="fu">c</span>(</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>((<span class="dv">1</span> <span class="sc">-</span> (frac_lpg <span class="sc">+</span> frac_wood <span class="sc">+</span> frac_char)) <span class="sc">*</span> hh_pop_tot, <span class="dv">0</span>),</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(frac_wood <span class="sc">*</span> hh_pop_tot, <span class="dv">0</span>),</span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(frac_lpg <span class="sc">*</span> hh_pop_tot, <span class="dv">0</span>),</span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a>      <span class="fu">round</span>(frac_char <span class="sc">*</span> hh_pop_tot, <span class="dv">0</span>)</span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>    )</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a><span class="do">### regional 2021 HH populations </span></span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a>gss_regional <span class="ot">&lt;-</span> <span class="fu">filter</span>(gss, region <span class="sc">!=</span> <span class="st">"Total"</span>) </span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>pop.region_hh <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">region =</span> gss_regional<span class="sc">$</span>region,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>  <span class="at">Freq =</span> gss_regional<span class="sc">$</span>hh_pop</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a><span class="co"># regional main fuel </span></span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a><span class="co">#specify known main fuel population values for each of the regions </span></span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>pop.region_main_fuel <span class="ot">&lt;-</span> gss_regional <span class="sc">%&gt;%</span> </span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">none_other =</span> fuel_none <span class="sc">+</span> fuel_other) <span class="sc">%&gt;%</span></span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">LPG =</span> fuel_lpg, </span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a>         <span class="at">wood =</span> fuel_wood, </span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a>         <span class="at">charcoal =</span> fuel_char) <span class="sc">%&gt;%</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, none_other, wood, LPG, charcoal) <span class="sc">%&gt;%</span></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>  <span class="co">#apply scaling factor so population matches GSS total value</span></span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">none_other =</span> <span class="fu">round</span>(none_other <span class="sc">*</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop<span class="sc">/</span><span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel, <span class="dv">0</span>),</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>         <span class="at">LPG =</span> <span class="fu">round</span>(LPG <span class="sc">*</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop<span class="sc">/</span><span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel,<span class="dv">0</span>),</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>         <span class="at">wood =</span> <span class="fu">round</span>(wood <span class="sc">*</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop<span class="sc">/</span><span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel, <span class="dv">0</span>),</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a>         <span class="at">charcoal =</span> <span class="fu">round</span>(charcoal <span class="sc">*</span> <span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop<span class="sc">/</span><span class="fu">subset</span>(gss, region <span class="sc">==</span> <span class="st">"Total"</span>)<span class="sc">$</span>hh_pop_fuel, <span class="dv">0</span>))</span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>northern <span class="ot">&lt;-</span> pop.region_main_fuel <span class="sc">%&gt;%</span></span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Upper East"</span>, <span class="st">"Upper West"</span>, <span class="st">"North East"</span>, <span class="st">"Northern"</span>, <span class="st">"Savannah"</span>, <span class="st">"Oti"</span>, <span class="st">"Bono"</span>, <span class="st">"Bono East"</span>, <span class="st">"Ahafo"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"northern"</span>,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>    <span class="at">none_other =</span> <span class="fu">sum</span>(none_other),</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>    <span class="at">wood =</span> <span class="fu">sum</span>(wood),</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>    <span class="at">LPG =</span> <span class="fu">sum</span>(LPG),</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a>    <span class="at">charcoal =</span> <span class="fu">sum</span>(charcoal)</span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>middle <span class="ot">&lt;-</span> pop.region_main_fuel <span class="sc">%&gt;%</span></span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ashanti"</span>, <span class="st">"Eastern"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-73"><a href="#cb1-73" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-74"><a href="#cb1-74" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"middle"</span>,</span>
<span id="cb1-75"><a href="#cb1-75" aria-hidden="true" tabindex="-1"></a>    <span class="at">none_other =</span> <span class="fu">sum</span>(none_other),</span>
<span id="cb1-76"><a href="#cb1-76" aria-hidden="true" tabindex="-1"></a>    <span class="at">wood =</span> <span class="fu">sum</span>(wood),</span>
<span id="cb1-77"><a href="#cb1-77" aria-hidden="true" tabindex="-1"></a>    <span class="at">LPG =</span> <span class="fu">sum</span>(LPG),</span>
<span id="cb1-78"><a href="#cb1-78" aria-hidden="true" tabindex="-1"></a>    <span class="at">charcoal =</span> <span class="fu">sum</span>(charcoal)</span>
<span id="cb1-79"><a href="#cb1-79" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-80"><a href="#cb1-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-81"><a href="#cb1-81" aria-hidden="true" tabindex="-1"></a>southeast <span class="ot">&lt;-</span> pop.region_main_fuel <span class="sc">%&gt;%</span></span>
<span id="cb1-82"><a href="#cb1-82" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Greater Accra"</span>, <span class="st">"Volta"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-83"><a href="#cb1-83" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-84"><a href="#cb1-84" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"southeast"</span>,</span>
<span id="cb1-85"><a href="#cb1-85" aria-hidden="true" tabindex="-1"></a>    <span class="at">none_other =</span> <span class="fu">sum</span>(none_other),</span>
<span id="cb1-86"><a href="#cb1-86" aria-hidden="true" tabindex="-1"></a>    <span class="at">wood =</span> <span class="fu">sum</span>(wood),</span>
<span id="cb1-87"><a href="#cb1-87" aria-hidden="true" tabindex="-1"></a>    <span class="at">LPG =</span> <span class="fu">sum</span>(LPG),</span>
<span id="cb1-88"><a href="#cb1-88" aria-hidden="true" tabindex="-1"></a>    <span class="at">charcoal =</span> <span class="fu">sum</span>(charcoal)</span>
<span id="cb1-89"><a href="#cb1-89" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-90"><a href="#cb1-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-91"><a href="#cb1-91" aria-hidden="true" tabindex="-1"></a>southwest <span class="ot">&lt;-</span> pop.region_main_fuel <span class="sc">%&gt;%</span></span>
<span id="cb1-92"><a href="#cb1-92" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Central"</span>, <span class="st">"Western"</span>, <span class="st">"Western North"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-93"><a href="#cb1-93" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-94"><a href="#cb1-94" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"southwest"</span>,</span>
<span id="cb1-95"><a href="#cb1-95" aria-hidden="true" tabindex="-1"></a>    <span class="at">none_other =</span> <span class="fu">sum</span>(none_other),</span>
<span id="cb1-96"><a href="#cb1-96" aria-hidden="true" tabindex="-1"></a>    <span class="at">wood =</span> <span class="fu">sum</span>(wood),</span>
<span id="cb1-97"><a href="#cb1-97" aria-hidden="true" tabindex="-1"></a>    <span class="at">LPG =</span> <span class="fu">sum</span>(LPG),</span>
<span id="cb1-98"><a href="#cb1-98" aria-hidden="true" tabindex="-1"></a>    <span class="at">charcoal =</span> <span class="fu">sum</span>(charcoal)</span>
<span id="cb1-99"><a href="#cb1-99" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-100"><a href="#cb1-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-101"><a href="#cb1-101" aria-hidden="true" tabindex="-1"></a>collapsed_region_primary_fuel <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(northern, middle, southeast, southwest)</span>
<span id="cb1-102"><a href="#cb1-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-103"><a href="#cb1-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-104"><a href="#cb1-104" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine primary fuel with each row specifying which is applicable </span></span>
<span id="cb1-105"><a href="#cb1-105" aria-hidden="true" tabindex="-1"></a>pop_region_primary_fuel_long <span class="ot">&lt;-</span> collapsed_region_primary_fuel <span class="sc">%&gt;%</span></span>
<span id="cb1-106"><a href="#cb1-106" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(none_other, wood, LPG, charcoal), <span class="at">names_to =</span> <span class="st">"collapsed_fuel"</span>, <span class="at">values_to =</span> <span class="st">"Count"</span>) <span class="co">#names need to match what is in the survey!!</span></span>
<span id="cb1-107"><a href="#cb1-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-108"><a href="#cb1-108" aria-hidden="true" tabindex="-1"></a><span class="co"># reformat this data so each row is a household (necessary for creating pop.table below)</span></span>
<span id="cb1-109"><a href="#cb1-109" aria-hidden="true" tabindex="-1"></a>pop_region_primary_fuel_long <span class="ot">&lt;-</span> pop_region_primary_fuel_long <span class="sc">%&gt;%</span></span>
<span id="cb1-110"><a href="#cb1-110" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(Count) <span class="sc">%&gt;%</span></span>
<span id="cb1-111"><a href="#cb1-111" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">collapsed_region =</span> region)</span>
<span id="cb1-112"><a href="#cb1-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-113"><a href="#cb1-113" aria-hidden="true" tabindex="-1"></a><span class="co">#create table of LPG main stove by collapsed regions</span></span>
<span id="cb1-114"><a href="#cb1-114" aria-hidden="true" tabindex="-1"></a>pop.table_primary_fuel <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span>collapsed_region<span class="sc">+</span>collapsed_fuel, pop_region_primary_fuel_long)</span>
<span id="cb1-115"><a href="#cb1-115" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-116"><a href="#cb1-116" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-117"><a href="#cb1-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-118"><a href="#cb1-118" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-119"><a href="#cb1-119" aria-hidden="true" tabindex="-1"></a><span class="co"># regional urbanicity </span></span>
<span id="cb1-120"><a href="#cb1-120" aria-hidden="true" tabindex="-1"></a><span class="co">#regional 2021 HH populations </span></span>
<span id="cb1-121"><a href="#cb1-121" aria-hidden="true" tabindex="-1"></a>pop.region_urban_rural_hh <span class="ot">&lt;-</span> gss_regional <span class="sc">%&gt;%</span></span>
<span id="cb1-122"><a href="#cb1-122" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(region, hh_pop_rural, hh_pop_urban) <span class="sc">%&gt;%</span></span>
<span id="cb1-123"><a href="#cb1-123" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">rural =</span> hh_pop_rural, </span>
<span id="cb1-124"><a href="#cb1-124" aria-hidden="true" tabindex="-1"></a>         <span class="at">urban =</span> hh_pop_urban)</span>
<span id="cb1-125"><a href="#cb1-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-126"><a href="#cb1-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-127"><a href="#cb1-127" aria-hidden="true" tabindex="-1"></a>northern <span class="ot">&lt;-</span> pop.region_urban_rural_hh <span class="sc">%&gt;%</span></span>
<span id="cb1-128"><a href="#cb1-128" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Upper East"</span>, <span class="st">"Upper West"</span>, <span class="st">"North East"</span>, <span class="st">"Northern"</span>, <span class="st">"Savannah"</span>, <span class="st">"Oti"</span>, <span class="st">"Bono"</span>, <span class="st">"Bono East"</span>, <span class="st">"Ahafo"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-129"><a href="#cb1-129" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-130"><a href="#cb1-130" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"northern"</span>,</span>
<span id="cb1-131"><a href="#cb1-131" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban =</span> <span class="fu">sum</span>(urban),</span>
<span id="cb1-132"><a href="#cb1-132" aria-hidden="true" tabindex="-1"></a>    <span class="at">rural =</span> <span class="fu">sum</span>(rural)</span>
<span id="cb1-133"><a href="#cb1-133" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-134"><a href="#cb1-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-135"><a href="#cb1-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-136"><a href="#cb1-136" aria-hidden="true" tabindex="-1"></a>middle <span class="ot">&lt;-</span> pop.region_urban_rural_hh <span class="sc">%&gt;%</span></span>
<span id="cb1-137"><a href="#cb1-137" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ashanti"</span>, <span class="st">"Eastern"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-138"><a href="#cb1-138" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-139"><a href="#cb1-139" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"middle"</span>,</span>
<span id="cb1-140"><a href="#cb1-140" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban =</span> <span class="fu">sum</span>(urban),</span>
<span id="cb1-141"><a href="#cb1-141" aria-hidden="true" tabindex="-1"></a>    <span class="at">rural =</span> <span class="fu">sum</span>(rural)</span>
<span id="cb1-142"><a href="#cb1-142" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-143"><a href="#cb1-143" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-144"><a href="#cb1-144" aria-hidden="true" tabindex="-1"></a>southeast <span class="ot">&lt;-</span> pop.region_urban_rural_hh <span class="sc">%&gt;%</span></span>
<span id="cb1-145"><a href="#cb1-145" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Greater Accra"</span>, <span class="st">"Volta"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-146"><a href="#cb1-146" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-147"><a href="#cb1-147" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"southeast"</span>,</span>
<span id="cb1-148"><a href="#cb1-148" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban =</span> <span class="fu">sum</span>(urban),</span>
<span id="cb1-149"><a href="#cb1-149" aria-hidden="true" tabindex="-1"></a>    <span class="at">rural =</span> <span class="fu">sum</span>(rural)</span>
<span id="cb1-150"><a href="#cb1-150" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-151"><a href="#cb1-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-152"><a href="#cb1-152" aria-hidden="true" tabindex="-1"></a>southwest <span class="ot">&lt;-</span> pop.region_urban_rural_hh <span class="sc">%&gt;%</span></span>
<span id="cb1-153"><a href="#cb1-153" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Central"</span>, <span class="st">"Western"</span>, <span class="st">"Western North"</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb1-154"><a href="#cb1-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb1-155"><a href="#cb1-155" aria-hidden="true" tabindex="-1"></a>    <span class="at">region =</span> <span class="st">"southwest"</span>,</span>
<span id="cb1-156"><a href="#cb1-156" aria-hidden="true" tabindex="-1"></a>    <span class="at">urban =</span> <span class="fu">sum</span>(urban),</span>
<span id="cb1-157"><a href="#cb1-157" aria-hidden="true" tabindex="-1"></a>    <span class="at">rural =</span> <span class="fu">sum</span>(rural)</span>
<span id="cb1-158"><a href="#cb1-158" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb1-159"><a href="#cb1-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-160"><a href="#cb1-160" aria-hidden="true" tabindex="-1"></a>collapsed_region_urban_rural_hh <span class="ot">&lt;-</span> <span class="fu">bind_rows</span>(northern, middle, southeast, southwest)</span>
<span id="cb1-161"><a href="#cb1-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-162"><a href="#cb1-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-163"><a href="#cb1-163" aria-hidden="true" tabindex="-1"></a><span class="co">#Combine LPG yes/no columns with each row specifying which is applicable </span></span>
<span id="cb1-164"><a href="#cb1-164" aria-hidden="true" tabindex="-1"></a>pop_region_urban_rural_long <span class="ot">&lt;-</span> collapsed_region_urban_rural_hh <span class="sc">%&gt;%</span></span>
<span id="cb1-165"><a href="#cb1-165" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="at">cols =</span> <span class="fu">c</span>(rural, urban), <span class="at">names_to =</span> <span class="st">"urban_rural_str"</span>, <span class="at">values_to =</span> <span class="st">"Count"</span>) <span class="co">#names need to match what is in the survey!!</span></span>
<span id="cb1-166"><a href="#cb1-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-167"><a href="#cb1-167" aria-hidden="true" tabindex="-1"></a><span class="co"># reformat this data so each row is a household (necessary for creating pop.table below)</span></span>
<span id="cb1-168"><a href="#cb1-168" aria-hidden="true" tabindex="-1"></a>pop_region_urban_rural_long <span class="ot">&lt;-</span> pop_region_urban_rural_long <span class="sc">%&gt;%</span></span>
<span id="cb1-169"><a href="#cb1-169" aria-hidden="true" tabindex="-1"></a>  <span class="fu">uncount</span>(Count) <span class="sc">%&gt;%</span></span>
<span id="cb1-170"><a href="#cb1-170" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">collapsed_region =</span> region)</span>
<span id="cb1-171"><a href="#cb1-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-172"><a href="#cb1-172" aria-hidden="true" tabindex="-1"></a><span class="co">#create table of LPG main stove by collapsed regions</span></span>
<span id="cb1-173"><a href="#cb1-173" aria-hidden="true" tabindex="-1"></a>pop.table_urban_rural <span class="ot">&lt;-</span> <span class="fu">xtabs</span>(<span class="sc">~</span>collapsed_region<span class="sc">+</span>urban_rural_str, pop_region_urban_rural_long)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="specifying-the-survey-design-using-rake-for-each-of-the-models" class="level3">
<h3 class="anchored" data-anchor-id="specifying-the-survey-design-using-rake-for-each-of-the-models">Specifying the Survey Design (using <code>Rake()</code>) for Each of the Models</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Un-weighted</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>unweighted_survey_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>eacode, <span class="co">#specify clusters</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">strata=</span> <span class="sc">~</span>region, <span class="co">#specify the region strata</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data=</span>full_survey_collapsed)</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="co">#base weights</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>survey_design <span class="ot">&lt;-</span> <span class="fu">svydesign</span>(<span class="at">id=</span><span class="sc">~</span>eacode, <span class="co">#specify clusters</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">weights=</span> <span class="sc">~</span>weight, <span class="co">#specify the survey weights</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">strata=</span> <span class="sc">~</span>region, <span class="co">#specify the region strata</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>                           <span class="at">data=</span>full_survey_collapsed)</span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Rake 1</span></span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a>raked_surv <span class="ot">&lt;-</span> <span class="fu">rake</span>(survey_design, </span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="sc">~</span>urban_rural_str, <span class="sc">~</span>region), </span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(pop.urban_rural_str, pop.region_hh)</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a>upper_weight <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">weights</span>(raked_surv, <span class="at">type =</span> <span class="st">"sampling"</span>)) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-21"><a href="#cb2-21" aria-hidden="true" tabindex="-1"></a>rake1_design <span class="ot">&lt;-</span> <span class="fu">trimWeights</span>(raked_surv, <span class="at">lower=</span><span class="fl">0.1</span>, <span class="at">upper=</span>upper_weight,</span>
<span id="cb2-22"><a href="#cb2-22" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">strict =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-23"><a href="#cb2-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-24"><a href="#cb2-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-25"><a href="#cb2-25" aria-hidden="true" tabindex="-1"></a><span class="co">#Rake 2</span></span>
<span id="cb2-26"><a href="#cb2-26" aria-hidden="true" tabindex="-1"></a>raked_surv <span class="ot">&lt;-</span> <span class="fu">rake</span>(survey_design, </span>
<span id="cb2-27"><a href="#cb2-27" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="sc">~</span>urban_rural_str<span class="sc">+</span>collapsed_region), </span>
<span id="cb2-28"><a href="#cb2-28" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(pop.table_urban_rural)</span>
<span id="cb2-29"><a href="#cb2-29" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb2-30"><a href="#cb2-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-31"><a href="#cb2-31" aria-hidden="true" tabindex="-1"></a>upper_weight <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">weights</span>(raked_surv, <span class="at">type =</span> <span class="st">"sampling"</span>)) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb2-32"><a href="#cb2-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-33"><a href="#cb2-33" aria-hidden="true" tabindex="-1"></a>rake2_design <span class="ot">&lt;-</span> <span class="fu">trimWeights</span>(raked_surv, <span class="at">lower=</span><span class="fl">0.1</span>, <span class="at">upper=</span>upper_weight,</span>
<span id="cb2-34"><a href="#cb2-34" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">strict =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-35"><a href="#cb2-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-36"><a href="#cb2-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-37"><a href="#cb2-37" aria-hidden="true" tabindex="-1"></a><span class="co">#Rake 3</span></span>
<span id="cb2-38"><a href="#cb2-38" aria-hidden="true" tabindex="-1"></a>raked_surv <span class="ot">&lt;-</span> <span class="fu">rake</span>(survey_design, <span class="fu">list</span>(<span class="sc">~</span>urban_rural_str, <span class="sc">~</span>collapsed_fuel, <span class="sc">~</span>region), <span class="fu">list</span>(pop.urban_rural_str, pop.primary_fuel, pop.region_hh), <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">20</span>, <span class="at">epsilon =</span> <span class="dv">1</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>))</span>
<span id="cb2-39"><a href="#cb2-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-40"><a href="#cb2-40" aria-hidden="true" tabindex="-1"></a>upper_weight <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">weights</span>(raked_surv, <span class="at">type =</span> <span class="st">"sampling"</span>)) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb2-41"><a href="#cb2-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-42"><a href="#cb2-42" aria-hidden="true" tabindex="-1"></a>rake3_design <span class="ot">&lt;-</span> <span class="fu">trimWeights</span>(raked_surv, <span class="at">lower=</span><span class="fl">0.1</span>, <span class="at">upper=</span>upper_weight,</span>
<span id="cb2-43"><a href="#cb2-43" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">strict =</span> <span class="cn">TRUE</span>)</span>
<span id="cb2-44"><a href="#cb2-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-45"><a href="#cb2-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-46"><a href="#cb2-46" aria-hidden="true" tabindex="-1"></a><span class="co">#Rake 4</span></span>
<span id="cb2-47"><a href="#cb2-47" aria-hidden="true" tabindex="-1"></a>raked_surv <span class="ot">&lt;-</span> <span class="fu">rake</span>(survey_design, </span>
<span id="cb2-48"><a href="#cb2-48" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(<span class="sc">~</span>urban_rural_str<span class="sc">+</span>collapsed_region, <span class="sc">~</span>collapsed_region<span class="sc">+</span>collapsed_fuel), </span>
<span id="cb2-49"><a href="#cb2-49" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">list</span>(pop.table_urban_rural, pop.table_primary_fuel), <span class="at">control =</span> <span class="fu">list</span>(<span class="at">maxit =</span> <span class="dv">15</span>, <span class="at">epsilon =</span> <span class="dv">1</span>))</span>
<span id="cb2-50"><a href="#cb2-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-51"><a href="#cb2-51" aria-hidden="true" tabindex="-1"></a>upper_weight <span class="ot">&lt;-</span> <span class="fu">mean</span>(<span class="fu">weights</span>(raked_surv, <span class="at">type =</span> <span class="st">"sampling"</span>)) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb2-52"><a href="#cb2-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-53"><a href="#cb2-53" aria-hidden="true" tabindex="-1"></a>rake4_design <span class="ot">&lt;-</span> <span class="fu">trimWeights</span>(raked_surv, <span class="at">lower=</span><span class="fl">0.1</span>, <span class="at">upper=</span>upper_weight,</span>
<span id="cb2-54"><a href="#cb2-54" aria-hidden="true" tabindex="-1"></a>                                   <span class="at">strict =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="calculating-the-survey-statistics-for-each-model" class="level3">
<h3 class="anchored" data-anchor-id="calculating-the-survey-statistics-for-each-model">Calculating the Survey Statistics for Each Model</h3>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>unweighted <span class="ot">&lt;-</span> <span class="fu">calculate_survey_stats</span>(unweighted_survey_design, <span class="st">"unweighted"</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>GL_FM <span class="ot">&lt;-</span> <span class="fu">calculate_survey_stats</span>(survey_design, <span class="st">"GL_FM"</span>)</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>rake1 <span class="ot">&lt;-</span> <span class="fu">calculate_survey_stats</span>(rake1_design, <span class="st">"rake1"</span>)</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>rake2 <span class="ot">&lt;-</span> <span class="fu">calculate_survey_stats</span>(rake2_design, <span class="st">"rake2"</span>)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>rake3 <span class="ot">&lt;-</span> <span class="fu">calculate_survey_stats</span>(rake3_design, <span class="st">"rake3"</span>)</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>rake4 <span class="ot">&lt;-</span> <span class="fu">calculate_survey_stats</span>(rake4_design, <span class="st">"rake4"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="results" class="level2">
<h2 class="anchored" data-anchor-id="results">Results</h2>
<p>The effectiveness of each raking model was evaluated by comparing survey results against GSS census data for included variables. Highlighted cells indicate a difference of at least 5 % between the given cell value and the GSS-2021 value. Raking generally enhanced the alignment with GSS values, particularly for variables directly adjusted in the models. The table below outlines the performance metrics across different models.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>high_level_results <span class="ot">&lt;-</span> <span class="fu">left_join</span>(GSS_stats, unweighted) <span class="sc">%&gt;%</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(GL_FM) <span class="sc">%&gt;%</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rake1) <span class="sc">%&gt;%</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rake2) <span class="sc">%&gt;%</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rake3) <span class="sc">%&gt;%</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(rake4) <span class="sc">%&gt;%</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rake1 =</span> <span class="fu">as.numeric</span>(rake1),</span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">rake2 =</span> <span class="fu">as.numeric</span>(rake2),</span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">rake3 =</span> <span class="fu">as.numeric</span>(rake3),</span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">rake4 =</span> <span class="fu">as.numeric</span>(rake4)) <span class="sc">%&gt;%</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(stat <span class="sc">!=</span> <span class="st">"total_households"</span>)</span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a><span class="co">#create shaded table of high level results</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a><span class="co"># Round GSS values to two decimal places</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>high_level_results<span class="sc">$</span>GSS <span class="ot">&lt;-</span> <span class="fu">round</span>(high_level_results<span class="sc">$</span>GSS, <span class="dv">2</span>)</span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate bounds with different methods for the first three rows and the rest</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>high_level_results<span class="sc">$</span>lower_bound <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(high_level_results) <span class="sc">&lt;=</span> <span class="dv">3</span>, high_level_results<span class="sc">$</span>GSS <span class="sc">*</span> <span class="fl">0.95</span>, high_level_results<span class="sc">$</span>GSS <span class="sc">-</span> <span class="dv">5</span>)</span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>high_level_results<span class="sc">$</span>upper_bound <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(high_level_results) <span class="sc">&lt;=</span> <span class="dv">3</span>, high_level_results<span class="sc">$</span>GSS <span class="sc">*</span> <span class="fl">1.05</span>, high_level_results<span class="sc">$</span>GSS <span class="sc">+</span> <span class="dv">5</span>)</span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Create the datatable with custom JS for highlighting and hide lower and upper bound columns</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a><span class="fu">datatable</span>(high_level_results, <span class="at">options =</span> <span class="fu">list</span>(</span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>  <span class="at">rowCallback =</span> <span class="fu">JS</span>(<span class="st">"</span></span>
<span id="cb4-27"><a href="#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="st">    function(row, data) {</span></span>
<span id="cb4-28"><a href="#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="st">      for (var i = 2; i &lt; data.length-2; i++) {</span></span>
<span id="cb4-29"><a href="#cb4-29" aria-hidden="true" tabindex="-1"></a><span class="st">        var lowerBound = parseFloat(data[data.length-2]);</span></span>
<span id="cb4-30"><a href="#cb4-30" aria-hidden="true" tabindex="-1"></a><span class="st">        var upperBound = parseFloat(data[data.length-1]);</span></span>
<span id="cb4-31"><a href="#cb4-31" aria-hidden="true" tabindex="-1"></a><span class="st">        var cellValue = parseFloat(data[i]);</span></span>
<span id="cb4-32"><a href="#cb4-32" aria-hidden="true" tabindex="-1"></a><span class="st">        if (cellValue &lt; lowerBound || cellValue &gt; upperBound) {</span></span>
<span id="cb4-33"><a href="#cb4-33" aria-hidden="true" tabindex="-1"></a><span class="st">          $('td:eq('+i+')', row).css('background-color', '#ff9999');</span></span>
<span id="cb4-34"><a href="#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="st">        }</span></span>
<span id="cb4-35"><a href="#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="st">      }</span></span>
<span id="cb4-36"><a href="#cb4-36" aria-hidden="true" tabindex="-1"></a><span class="st">    }"</span></span>
<span id="cb4-37"><a href="#cb4-37" aria-hidden="true" tabindex="-1"></a>  ),</span>
<span id="cb4-38"><a href="#cb4-38" aria-hidden="true" tabindex="-1"></a>  <span class="at">columnDefs =</span> <span class="fu">list</span>(<span class="fu">list</span>(<span class="at">visible =</span> <span class="cn">FALSE</span>, <span class="at">targets =</span> <span class="fu">c</span>(<span class="fu">ncol</span>(high_level_results)<span class="sc">-</span><span class="dv">1</span>, <span class="fu">ncol</span>(high_level_results))))</span>
<span id="cb4-39"><a href="#cb4-39" aria-hidden="true" tabindex="-1"></a>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div class="datatables html-widget html-fill-item-overflow-hidden html-fill-item" id="htmlwidget-8ec2761fff0188c3db59" style="width:100%;height:auto;"></div>
<script type="application/json" data-for="htmlwidget-8ec2761fff0188c3db59">{"x":{"filter":"none","vertical":false,"data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15"],["hh_size","hh_size_rural","hh_size_urban","pct_rural","pct_LPG","pct_CW","pct_LPG_urban","pct_LPG_rural","pct_borehole","pct_sachet","pct_pipe_tap","pct_rooms_two_plus","pct_sleeping_rooms_two_plus","pct_separate_cooking","pct_electric_light"],[3.6,4,3.3,39.33,36.93,54.3,51.27,14.83,17.69,37.44,31.71,51.67,36.66,47.73,86.31],["4.19","4.48","3.88","52.10","19.62","76.25","32.81","7.51","25.12","29.35","33.87","79.51","33.59","49.29","81.04"],["3.79","4.14","3.62","32.89","32.47","63.83","42.77","11.47","12.60","43.68","35.91","75.98","31.40","49.81","88.26"],[3.84,4.19,3.61,39.39,30.35,66.05,42.71,11.33,14.88,42.21,34.66,76.45999999999999,31.22,50.01,86.67],[3.84,4.14,3.65,39.22,29.85,66.61,41.82,11.3,14.7,41.55,35.16,75.98,31.1,50.12,86.67],[3.78,4.19,3.5,39.7,36.66,55.02,51.9,13.51,15.36,42.65,33.56,76.27,30.75,51.22,86.41],[3.78,4.11,3.56,39.58,36.91,55.59,51.98,13.91,15.11,42.04,34.04,75.81,30.71,51.57,86.55],[3.42,3.8,3.135,34.33,31.93,49.3,46.27,9.83,12.69,32.44,26.71,46.67,31.66,42.73,81.31],[3.78,4.2,3.465,44.33,41.93,59.3,56.27,19.83,22.69,42.44,36.71,56.67,41.66,52.73,91.31]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>stat<\/th>\n      <th>GSS<\/th>\n      <th>unweighted<\/th>\n      <th>GL_FM<\/th>\n      <th>rake1<\/th>\n      <th>rake2<\/th>\n      <th>rake3<\/th>\n      <th>rake4<\/th>\n      <th>lower_bound<\/th>\n      <th>upper_bound<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"rowCallback":"\n    function(row, data) {\n      for (var i = 2; i < data.length-2; i++) {\n        var lowerBound = parseFloat(data[data.length-2]);\n        var upperBound = parseFloat(data[data.length-1]);\n        var cellValue = parseFloat(data[i]);\n        if (cellValue < lowerBound || cellValue > upperBound) {\n          $('td:eq('+i+')', row).css('background-color', '#ff9999');\n        }\n      }\n    }","columnDefs":[{"visible":false,"targets":[9,10]},{"className":"dt-right","targets":[2,5,6,7,8,9,10]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false}},"evals":["options.rowCallback"],"jsHooks":[]}</script>
</div>
</div>
</section>
<section id="conclusions" class="level2">
<h2 class="anchored" data-anchor-id="conclusions">Conclusions</h2>
<p>As expected, we found that the raking process consistently improved alignment with GSS values for raked variables. For statistics where the variable was not included in the raking process, we found the results sometimes better aligned post-raking and never became concerningly worse.</p>
<p>As the statistics for variables not used in the raking process tended to remain stable or improved slightly in the version of our raking model that utilized the most information in the set up (rake 4), we decided to move ahead with that model. Additional sensitivity analysis was conducted to examine the stability of the results when using different regional groupings.</p>
</section>
<section id="sensitivity-analysis-grouping-variations" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-analysis-grouping-variations">Sensitivity Analysis: Grouping Variations</h2>
<p>We explored different regional groupings to ensure robust model performance without convergence issues. Grouping strategies were informed by demographic similarities and household population sizes, ensuring meaningful comparisons and reliable raking results.</p>
<div class="cell">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> regions, <span class="fu">aes</span>(<span class="at">fill =</span> region)) <span class="sc">+</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Region"</span>,</span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Regions of Ghana"</span>)<span class="sc">+</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis text</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis titles</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Maps-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a>rake1_regions <span class="ot">&lt;-</span> regions <span class="sc">%&gt;%</span></span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collapsed_region =</span> <span class="fu">case_when</span>(</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ashanti"</span>, <span class="st">"Eastern"</span>) <span class="sc">~</span> <span class="st">"middle"</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Upper East"</span>, <span class="st">"Upper West"</span>, <span class="st">"Northern East"</span>, <span class="st">"Northern"</span>, <span class="st">"Savannah"</span>, <span class="st">"Oti"</span>, <span class="st">"Bono"</span>, <span class="st">"Bono East"</span>, <span class="st">"Ahafo"</span>) <span class="sc">~</span> <span class="st">"northern"</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Greater Accra"</span>, <span class="st">"Volta"</span>) <span class="sc">~</span> <span class="st">"southeast"</span>,</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Central"</span>, <span class="st">"Western"</span>, <span class="st">"Western North"</span>) <span class="sc">~</span> <span class="st">"southwest"</span>,</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> region)) <span class="sc">%&gt;%</span></span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collapsed_region =</span> <span class="fu">factor</span>(collapsed_region, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"northern"</span>, <span class="st">"middle"</span>, <span class="st">"southeast"</span>, <span class="st">"southwest"</span>)))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom colors for each region</span></span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"middle"</span> <span class="ot">=</span> <span class="st">"#2b8f6d"</span>, </span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"northern"</span> <span class="ot">=</span> <span class="st">"#58b368"</span>, </span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"southeast"</span> <span class="ot">=</span> <span class="st">"#bcba50"</span>, </span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"southwest"</span> <span class="ot">=</span> <span class="st">"#EFEEB4"</span></span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rake1_regions, <span class="fu">aes</span>(<span class="at">fill =</span> collapsed_region)) <span class="sc">+</span></span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors) <span class="sc">+</span></span>
<span id="cb6-20"><a href="#cb6-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb6-21"><a href="#cb6-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Region"</span>,</span>
<span id="cb6-22"><a href="#cb6-22" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Rake 4a Collapsed Regions"</span>) <span class="sc">+</span></span>
<span id="cb6-23"><a href="#cb6-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb6-24"><a href="#cb6-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb6-25"><a href="#cb6-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis text</span></span>
<span id="cb6-26"><a href="#cb6-26" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis titles</span></span>
<span id="cb6-27"><a href="#cb6-27" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb6-28"><a href="#cb6-28" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Maps-2.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>rake2_regions <span class="ot">&lt;-</span> regions <span class="sc">%&gt;%</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collapsed_region =</span> <span class="fu">case_when</span>(</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ashanti"</span>, <span class="st">"Eastern"</span>) <span class="sc">~</span> <span class="st">"middle"</span>,</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Upper East"</span>, <span class="st">"Upper West"</span>, <span class="st">"Northern East"</span>, <span class="st">"Northern"</span>, <span class="st">"Savannah"</span>, <span class="st">"Oti"</span>, <span class="st">"Western North"</span>, <span class="st">"Bono"</span>, <span class="st">"Bono East"</span>, <span class="st">"Ahafo"</span>) <span class="sc">~</span> <span class="st">"northern"</span>,</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Greater Accra"</span>, <span class="st">"Volta"</span>, <span class="st">"Central"</span>, <span class="st">"Western"</span>) <span class="sc">~</span> <span class="st">"coastal"</span>,</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> region)) <span class="sc">%&gt;%</span></span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collapsed_region =</span> <span class="fu">factor</span>(collapsed_region, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"northern"</span>, <span class="st">"middle"</span>, <span class="st">"coastal"</span>)))</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom colors for each region</span></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"middle"</span> <span class="ot">=</span> <span class="st">"#2b8f6d"</span>, </span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"northern"</span> <span class="ot">=</span> <span class="st">"#58b368"</span>, </span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"coastal"</span> <span class="ot">=</span> <span class="st">"#EFEEB4"</span></span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rake2_regions, <span class="fu">aes</span>(<span class="at">fill =</span> collapsed_region)) <span class="sc">+</span></span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors) <span class="sc">+</span></span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Region"</span>,</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Rake 4b Collapsed Regions"</span>) <span class="sc">+</span></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis text</span></span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis titles</span></span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Maps-3.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>rake3_regions <span class="ot">&lt;-</span> regions <span class="sc">%&gt;%</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collapsed_region =</span> <span class="fu">case_when</span>(</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Ashanti"</span>, <span class="st">"Eastern"</span>, <span class="st">"Volta"</span>) <span class="sc">~</span> <span class="st">"middle"</span>,</span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Upper East"</span>, <span class="st">"Upper West"</span>, <span class="st">"Northern East"</span>, <span class="st">"Northern"</span>, <span class="st">"Savannah"</span>, <span class="st">"Oti"</span>, <span class="st">"Western North"</span>, <span class="st">"Bono"</span>, <span class="st">"Bono East"</span>, <span class="st">"Ahafo"</span>) <span class="sc">~</span> <span class="st">"northern"</span>,</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  region <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">"Greater Accra"</span>, <span class="st">"Central"</span>, <span class="st">"Western"</span>) <span class="sc">~</span> <span class="st">"coastal"</span>,</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>  <span class="cn">TRUE</span> <span class="sc">~</span> region)) <span class="sc">%&gt;%</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">collapsed_region =</span> <span class="fu">factor</span>(collapsed_region, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">"northern"</span>, <span class="st">"middle"</span>, <span class="st">"coastal"</span>)))</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Define custom colors for each region</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>custom_colors <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">"middle"</span> <span class="ot">=</span> <span class="st">"#2b8f6d"</span>, </span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"northern"</span> <span class="ot">=</span> <span class="st">"#58b368"</span>, </span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>                   <span class="st">"coastal"</span> <span class="ot">=</span> <span class="st">"#EFEEB4"</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>                   )</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_sf</span>(<span class="at">data =</span> rake3_regions, <span class="fu">aes</span>(<span class="at">fill =</span> collapsed_region)) <span class="sc">+</span></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> custom_colors) <span class="sc">+</span></span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">fill =</span> <span class="st">"Region"</span>,</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>       <span class="at">title =</span> <span class="st">"Rake 4c Collapsed Regions"</span>) <span class="sc">+</span></span>
<span id="cb8-21"><a href="#cb8-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">20</span>)) <span class="sc">+</span></span>
<span id="cb8-22"><a href="#cb8-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(</span>
<span id="cb8-23"><a href="#cb8-23" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.text =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis text</span></span>
<span id="cb8-24"><a href="#cb8-24" aria-hidden="true" tabindex="-1"></a>    <span class="at">axis.title =</span> <span class="fu">element_blank</span>(),  <span class="co"># Remove axis titles</span></span>
<span id="cb8-25"><a href="#cb8-25" aria-hidden="true" tabindex="-1"></a>    <span class="at">panel.grid =</span> <span class="fu">element_blank</span>()</span>
<span id="cb8-26"><a href="#cb8-26" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="index_files/figure-html/Maps-4.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="sensitivity-analysis-results" class="level2">
<h2 class="anchored" data-anchor-id="sensitivity-analysis-results">Sensitivity Analysis: Results</h2>
<p>The table below shows the results from our sensitivity analysis and follows a similar format to the previous table. Here, the statistics are broken up by variables used in the raking process and those that were not.</p>
<p><img src="rake_sensitivity_table.png" class="img-fluid"></p>
<p>Overall, the results from the sensitivity analysis showed stability across the three groupings. Based on this, the team in Ghana decided which groupings of regions made the most sense based on knowledge of the regions, selecting 4a as their preferred model.</p>
</section>
</section>
<section id="bibliography" class="level1">
<h1>Bibliography:</h1>
<p>Battaglia, M., Izrael, D., Hoaglin, D., &amp; Frankel, M. (2004a). Tips and Tricks for Raking Survey Data (aka Sample Balancing). Abt Associates.</p>
<p>Battaglia, M. P., Hoaglin, D. C., &amp; Frankel, M. R. (2009). Practical Considerations in Raking Survey Data. Survey Practice, 2(5). https://doi.org/10.29115/SP-2009-0019</p>
<p>Brick, J. M., Montaquila, J., Roth, S., &amp; Brick, J. M. (2003). IDENTIFYING PROBLEMS WITH RAKING ESTIMATORS.</p>
<p>Calibrating Survey Data using Iterative Proportional Fitting (Raking). (n.d.). https://doi.org/10.1177/1536867X1401400104</p>
<p>DeBell, M., &amp; Krosnick, J. A. (n.d.). Computing Weights for American National Election Study Survey Data.</p>
<p>Kennedy, A. M., Arnold Lau and Courtney. (2018, January 26). 1. How different weighting methods work. Pew Research Center. https://www.pewresearch.org/methods/2018/01/26/how-different-weighting-methods-work/</p>


</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" id="quarto-citation"><h2 class="anchored quarto-appendix-heading">Citation</h2><div><div class="quarto-appendix-secondary-label">BibTeX citation:</div><pre class="sourceCode code-with-copy quarto-appendix-bibtex"><code class="sourceCode bibtex">@online{white2024,
  author = {White, Lewis},
  title = {Raking to {Improve} {Survey} {Weights}},
  date = {2024-05-03},
  url = {https://lewis-r-white.github.io/posts/2024-05-03-survey-raking/},
  langid = {en}
}
</code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre><div class="quarto-appendix-secondary-label">For attribution, please cite this work as:</div><div id="ref-white2024" class="csl-entry quarto-appendix-citeas" role="listitem">
White, Lewis. 2024. <span>“Raking to Improve Survey Weights.”</span> May
3, 2024. <a href="https://lewis-r-white.github.io/posts/2024-05-03-survey-raking/">https://lewis-r-white.github.io/posts/2024-05-03-survey-raking/</a>.
</div></div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>