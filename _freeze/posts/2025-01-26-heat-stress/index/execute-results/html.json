{
  "hash": "d233959ee830a37bdee8d08682bd4108",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Preliminary Analysis of Heat’s Impact on Mental Health Among  Pregnancy Cohort\"\ndescription: \"This analysis was included in a grant proposal that aims to further explore the impacts of temperature on mental health and test whether an intervention related to heat warning education could improve health outcomes.\"\nauthor: \n  - name: Lewis White\n    url: https://lewis-r-white.github.io/\n    affiliation: Columbia University\ndate: 01-26-2025\ncategories: [Columbia University, Stats, R, Health]\ncitation:\n  url: https://lewis-r-white.github.io/posts/2025-01-26-heat-stress/\neditor: visual\nimage: sun_heat.jpg\ndraft: false \nformat:\n  html:\n    code-fold: true\n---\n\n\n\n\n## Background\n\nPregnancy and the postpartum period can be an especially challenging time for women’s mental health—no matter where they live or what their circumstances are. In the U.S., around 13% of women experience perinatal depression \\[1\\]. However, in many lower-income settings, these numbers are much higher. In Ghana, for instance, perinatal depression has been reported in up to 50% of pregnancies, with 13–17% of women experiencing suicidal thoughts \\[2\\].\n\nRural areas, where healthcare services are often harder to access, seem to face the highest risks. Compounding the issue, Ghana (like much of sub-Saharan Africa) doesn’t have a routine screening protocol for perinatal depression and anxiety, leaving many cases undetected and untreated \\[3\\].\n\nMeanwhile, research in climate and health has increasingly shown that extreme temperatures can impact mental health \\[4\\]. Evidence suggests that heat exposure may trigger inflammation in the hypothalamic-pituitary-adrenal (HPA) axis—which plays a key role in managing the body’s response to stress—and that activation contributes to anxiety \\[5\\].\n\n## **Objectives**\n\nThe analysis described below was originally prepared for a grant proposal aiming to build on existing research that links heat exposure to mental health challenges. If this grant is funded, the project will investigate the causal impact of high temperatures on maternal mental health in Ghana, explore the underlying mechanisms (e.g. physiological or social), and pilot a heat warning system to assess whether targeted interventions can mitigate these risks.\n\nAs a starting point, I used data from an ongoing pregnancy cohort in rural Ghana to highlight existing associations between heat and mental health in our target population. My preliminary analysis emphasizes the need for further research in this area and sets the stage for a larger-scale project should the proposal move forward.\n\n## **Data Used In Analysis**\n\n### Pregnancy Cohort Data\n\nFor this analysis, I used data from the Ghana Randomized Air Pollution and Health Study (GRAPHS)—a pregnancy cohort from rural, agrarian communities that began recruitment in 2014 and includes years of follow-up data collection. Among its many measures, GRAPHS includes mental health assessments, as well as possible biological and social mechanisms contributing to mental health, such as sleep, comorbid diseases, and various health and demographic data.\n\nOf these measures, 3 stood out to my team as particularly well-suited for the grant proposal:\n\n1.  **Perceived Stress Scale (PSS)\\\n    **A holistic, self-reported measure of how much control individuals feel they have over their lives. In the GRAPHS cohort, this survey consists of four questions about the frequency of certain feelings or situations, and a total score is calculated based on the responses.\n\n2.  **Sum Negative Domain Score (NDS)\\\n    **A measure centered on specific, stress-inducing life events (e.g., financial troubles, medical issues, etc.). Respondents self-reported which events they experienced and rated them as positive, negative, or neutral. Negative events were then summed across domains—financial, medical, and so on—to create the NDS. This approach allowed us to categorize pregnant women into three groups: low stress (NDS = 0–1), moderate stress (NDS = 3–5), and high stress (NDS \\> 5).\n\n3.  **Actigraphy for Sleep\\\n    **Objective sleep measurements were collected from participants wearing watch-like devices (actigraphs) to estimate rest/activity cycles. Data were gathered from 156 participants during both single-night and multi-night recordings at two follow-up periods (4 and 8 years postpartum).\n\nWe decided to focus on all three measures to gain a well-rounded perspective on maternal stress—looking at how women feel in general, what real-life stressors they face, and how well they’re sleeping. By combining these different angles, we can be more confident in our overall findings.\n\n### Temperature Data\n\nI initially looked at four different heat metrics—Sea Surface Temperature, Heat Index, Wet Bulb Temperature, and Wet Bulb Globe Temperature (WBGT). I ultimately chose WBGT because it’s well-known for capturing not just temperature, but also humidity, wind speed, and solar radiation. Military agencies, OSHA, and other groups rely on WBGT for guidelines on safe activity levels.\n\nSince the grant zeroes in on high-heat events, I used daily maximum WBGT (derived from hourly readings) as the key measurement for this analysis.\n\n## Methods of Analysis\n\nFor this preliminary analysis, I used a few different modeling approaches—distributed lag models (DLMs) and two types of regression—to explore how temperature exposure over time may impact mental health outcomes.\n\n-   **Distributed Lag Models (DLMs):** DLMs provide a flexible way to assess how temperature exposure at different points in time might influence stress levels. Instead of focusing on a single time window (e.g., just the day before the survey), DLMs capture both delayed and cumulative effects over the full 270-day pregnancy period. I started with this approach to get a clearer picture of how far back high temperatures might impact later mental health outcomes.\\\n    \\\n    The sections below focus on the regression results, but for those interested, I’ve included the full DLM results and interpretations in the appendix.\n\n-   **Linear Regression:** Linear regression examines the relationship between a continuous predictor (like average WBGT) and a continuous outcome (such as the PSS-4 score). Based on initial results from the DLM, I looked at whether higher average WBGT in each trimester—or over the entire pregnancy—was linked to changes in stress levels or total sleep duration.\n\n-   **Ordered Logistic Regression:** Since the sample was divided into ordered stress categories (low, moderate, and high) based on the NDS score, ordered logistic regression helps estimate the odds of being in a higher stress category given temperature exposure.\n\n## Exploring the relationship between temperature and perceived stress (PSS)\n\n#### Linear Regression\n\nTo investigate the relationship between heat exposure (WBGT) and perceived stress scores (PSS-4) during pregnancy, I calculated trimester-specific daily maximum WBGT averages as well as the overall average of daily maximum WBGT for the entire pregnancy. For the third trimester and full pregnancy period, I restricted the WBGT averages to temperatures recorded up to the survey date to ensure alignment with the stress assessment period.\n\nAs described earlier, I used a linear regression model to assess the association between PSS-4 and WBGT for each time period. Initially, I included covariates such as demographic, socioeconomic, and physical health data, but these variables did not significantly contribute to the model or improve its overall quality. For simplicity, I excluded them from the final results presented in the grant proposal and this blog.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n## SET UP THE DATA -- find temps over custom periods of interest\n\n# Function to process temperature data for the selected metric\nprocess_temperature_data <- function(era5_data, metric) {\n  era5_data %>%\n    select(community, date, !!sym(metric)) %>%\n    rename(temp_metric = !!sym(metric)) %>%\n    distinct()\n}\n\n# Process temp data\ntemp_data_clean <- process_temperature_data(era5_data = era5, metric = \"max_wbgt\")\n\n\ncalc_custom_temp_avg <- function(stress_data, temp_data) {\n  stress_data %>%\n    rowwise() %>%  # Perform operations for each row (unique survey observation)\n    mutate(\n      # Temperature on the day of the survey\n      avg_temp_day_of_survey = temp_data %>%\n        filter(community == vname, date == survey_date) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Temperature the day before the survey\n      avg_temp_day_before_survey = temp_data %>%\n        filter(community == vname, date == survey_date - 1) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature for the week before the survey\n      avg_temp_week_before_survey = temp_data %>%\n        filter(community == vname, date >= survey_date - 7 & date < survey_date) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature for the 3 months before the survey\n      avg_temp_3_months_before = temp_data %>%\n        filter(community == vname, date >= survey_date - 90 & date < survey_date) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature for the 6 months before the survey\n      avg_temp_6_months_before = temp_data %>%\n        filter(community == vname, date >= survey_date - 180 & date < survey_date) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      ## TRIMESTER TEMP CALCULATIONS\n      # Estimate conception date (280 days before delivery)\n      \n      # Use gestational age if available, otherwise default to 280 - medical average (not our average) gestation period \n      gestage_days = ifelse(is.na(gestage_days), 280, gestage_days),\n      \n      # Calculate conception date based on gestational age\n      conception_date = datdeliv - gestage_days,\n  \n      # Pre-conception temperature average (60 days before conception)\n      avg_temp_pre_conception = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date - 60 & date < conception_date\n        ) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # First trimester temperature average\n      avg_temp_first_trimester = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date & date < conception_date + 90\n        ) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Second trimester temperature average\n      avg_temp_second_trimester = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date + 91 & date < conception_date + 180\n        ) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Third trimester temperature average\n      avg_temp_third_trimester = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date + 181 & date <= survey_date # only include up until the survey date\n        ) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp),\n     \n       # Average temperature across the entire pregnancy\n      avg_temp_entire_pregnancy = temp_data %>%\n        filter(\n          community == vname,  \n          date >= conception_date & date <= survey_date  # Filter pregnancy period estimated as 280 days before delivery. Only include up until the survey date. \n        ) %>%\n        summarise(mean_temp = mean(temp_metric, na.rm = TRUE)) %>%\n        pull(mean_temp)  \n      \n    ) %>%\n    ungroup()  # Remove row-wise grouping\n}\n\n# Add custom periods\npss_simple_custom_lags <- calc_custom_temp_avg(stress_data = pss_simple, temp_data = temp_data_clean)\n\n\n\n\n# Rename variables in the dataset\npss_simple_custom_lags_renamed <- pss_simple_custom_lags %>%\n  rename(\n    `Average Temp Entire Pregnancy` = avg_temp_entire_pregnancy,\n    `Average Temp Pre-Conception` = avg_temp_pre_conception,\n    `Average Temp First Trimester` = avg_temp_first_trimester,\n    `Average Temp Second Trimester` = avg_temp_second_trimester,\n    `Average Temp Third Trimester` = avg_temp_third_trimester\n  ) %>%\n  rename(`Number of Lifetime Pregnancies` = pregchn)\n\n# Define models for PSS4\nWBGT_daily_max_models_pss_renamed <- list(\n  lm(PSS4 ~ `Average Temp Entire Pregnancy`, data = pss_simple_custom_lags_renamed),\n  lm(PSS4 ~ `Average Temp Pre-Conception`, data = pss_simple_custom_lags_renamed),\n  lm(PSS4 ~ `Average Temp First Trimester`, data = pss_simple_custom_lags_renamed),\n  lm(PSS4 ~ `Average Temp Second Trimester`, data = pss_simple_custom_lags_renamed),\n  lm(PSS4 ~ `Average Temp Third Trimester`, data = pss_simple_custom_lags_renamed)\n)\n# Display model summaries for PSS4\nstargazer(WBGT_daily_max_models_pss_renamed, type = \"text\", title = \"Regression Results: PSS vs. WBGT Temperatures\",\n          column.labels = c(\"Entire Pregnancy\", \n                            \"Pre-Conception\", \n                            \"First Trimester\", \n                            \"Second Trimester\", \n                            \"Third Trimester\"),\n          dep.var.labels = \"Perceived Stress Score\", \n          omit.stat = c(\"f\", \"ser\"), \n          no.space = TRUE, digits = 2,\n          star.cutoffs = c(0.05, 0.01, 0.001)) # Custom significance levels)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n\nRegression Results: PSS vs. WBGT Temperatures\n================================================================================================================\n                                                              Dependent variable:                               \n                                --------------------------------------------------------------------------------\n                                                             Perceived Stress Score                             \n                                Entire Pregnancy Pre-Conception First Trimester Second Trimester Third Trimester\n                                      (1)             (2)             (3)             (4)              (5)      \n----------------------------------------------------------------------------------------------------------------\n`Average Temp Entire Pregnancy`      0.87**                                                                     \n                                     (0.28)                                                                     \n`Average Temp Pre-Conception`                        -0.13                                                      \n                                                     (0.15)                                                     \n`Average Temp First Trimester`                                      0.47**                                      \n                                                                    (0.15)                                      \n`Average Temp Second Trimester`                                                     0.59***                     \n                                                                                     (0.17)                     \n`Average Temp Third Trimester`                                                                        -0.02     \n                                                                                                     (0.21)     \nConstant                            -17.20*          10.15*          -6.48           -9.43*           6.90      \n                                     (7.50)          (3.99)         (4.11)           (4.52)          (5.59)     \n----------------------------------------------------------------------------------------------------------------\nObservations                          428             428             428             428              428      \nR2                                    0.02           0.002           0.02             0.03           0.0000     \nAdjusted R2                           0.02          -0.0004          0.02             0.03           -0.002     \n================================================================================================================\nNote:                                                                              *p<0.05; **p<0.01; ***p<0.001\n```\n\n\n:::\n:::\n\n\nThe results indicate that:\n\n-   Elevated heat exposure during the entire pregnancy is significantly associated with elevated perceived stress levels. For every 1°C increase in the average daily maximum WBGT, our model predicts that the perceived stress score would increase on average by 0.87 (p \\< 0.01).\n\n-   Higher average daily maximum WBGT during the first trimester (β = 0.47, p \\< 0.01) and second trimester (β = 0.59, p \\< 0.001) are both significantly associated with increased PSS-4 scores. \n\n-   The third trimester average showed no significant effect, suggesting that elevated temperatures closer to the survey date are less strongly linked to stress levels.\n\n-   Higher WBGT during the preconception period is associated with a slight, insignificant reduction in PSS-4 scores.\n\n### \n\n## Exploring the relationship between temperature and sum NDS category\n\n#### Ordered Logistic Regression\n\nTo further explore the link between heat stress and mental health during pregnancy, I calculated trimester-specific averages of daily maximum WBGT as well as the overall average of daily maximum WBGT for the full pregnancy period. As mentioned earlier, I used ordered logistic regression to assess the association between Sum NDS Category and WBGT averages, since Sum NDS is a categorical variable with a natural order (low, moderate, and high stress).\n\n\n::: {.cell}\n\n```{.r .cell-code}\ncalc_custom_temp_avg <- function(stress_data, temp_data, metric) {\n  stress_data %>%\n    rowwise() %>%\n    mutate(\n      # Temperature on the day of the survey\n      avg_temp_day_of_survey = temp_data %>%\n        filter(community == vname, date == survey_date) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Temperature the day before the survey\n      avg_temp_day_before_survey = temp_data %>%\n        filter(community == vname, date == survey_date - 1) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature for the week before the survey\n      avg_temp_week_before_survey = temp_data %>%\n        filter(community == vname, date >= survey_date - 7 & date < survey_date) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n       # Average temperature for the month before the survey\n      avg_temp_month_before_survey = temp_data %>%\n        filter(community == vname, date >= survey_date - 30 & date < survey_date) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature for the 3 months before the survey\n      avg_temp_3_months_before = temp_data %>%\n        filter(community == vname, date >= survey_date - 90 & date < survey_date) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature for the 6 months before the survey\n      avg_temp_6_months_before = temp_data %>%\n        filter(community == vname, date >= survey_date - 180 & date < survey_date) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      ## TRIMESTER TEMP CALCULATIONS\n      # Estimate conception date (280 days before delivery)\n      \n      # Use gestational age if available, otherwise default to 280 - medical average (not our average) gestation period \n      gestage_days = ifelse(is.na(gestage_days), 280, gestage_days),\n      \n      # Calculate conception date based on gestational age\n      conception_date = datdeliv - gestage_days,\n  \n      # Pre-conception temperature average (60 days before conception)\n      avg_temp_pre_conception = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date - 60 & date < conception_date\n        ) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # First trimester temperature average\n      avg_temp_first_trimester = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date & date < conception_date + 90\n        ) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Second trimester temperature average\n      avg_temp_second_trimester = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date + 91 & date < conception_date + 180\n        ) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Third trimester temperature average\n      avg_temp_third_trimester = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date + 181 & date <= survey_date\n        ) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp),\n      \n      # Average temperature across the entire pregnancy\n      avg_temp_entire_pregnancy = temp_data %>%\n        filter(\n          community == vname,\n          date >= conception_date & date <= survey_date\n        ) %>%\n        summarise(mean_temp = mean(!!sym(metric), na.rm = TRUE)) %>%\n        pull(mean_temp)\n    ) %>%\n    ungroup()\n}\n\n\n\n\nmetrics <- \"max_wbgt\"\n\n# Initialize an empty list to store results\nregression_results_polr <- list()\n\n# Loop through each metric\nfor (metric in metrics) {\n  \n  # Calculate custom temperature averages\n  stress_data_with_temp <- calc_custom_temp_avg(crisis_simple, era5, metric)\n  \n  # Fit ordered logistic regressions for the metric\n  models <- list(\n    polr(formula = sum_nds_category ~ avg_temp_day_of_survey, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_day_before_survey, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_week_before_survey, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_month_before_survey, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_3_months_before, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_6_months_before, data = stress_data_with_temp, method = \"logistic\")\n  )\n  \n  # Save results for the current metric\n  regression_results_polr[[metric]] <- models\n}\n\n\n# List to store regression results and p-values\nregression_results <- list()\n\n# Loop through each metric\nfor (metric in metrics) {\n  \n  # Calculate custom temperature averages\n  stress_data_with_temp <- calc_custom_temp_avg(crisis_simple, era5, metric)\n  \n  # Fit models (6 regressions for survey date, 5 for pregnancy period)\n  models <- list(\n    # polr(formula = sum_nds_category ~ avg_temp_day_of_survey, data = stress_data_with_temp, method = \"logistic\"),\n    # polr(formula = sum_nds_category ~ avg_temp_day_before_survey, data = stress_data_with_temp, method = \"logistic\"),\n    # polr(formula = sum_nds_category ~ avg_temp_week_before_survey, data = stress_data_with_temp, method = \"logistic\"),\n    # polr(formula = sum_nds_category ~ avg_temp_month_before_survey, data = stress_data_with_temp, method = \"logistic\"),\n    # polr(formula = sum_nds_category ~ avg_temp_3_months_before, data = stress_data_with_temp, method = \"logistic\"),\n    # polr(formula = sum_nds_category ~ avg_temp_6_months_before, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_pre_conception, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_first_trimester, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_second_trimester, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_third_trimester, data = stress_data_with_temp, method = \"logistic\"),\n    polr(formula = sum_nds_category ~ avg_temp_entire_pregnancy, data = stress_data_with_temp, method = \"logistic\")\n  )\n  \n  # Extract coefficients and p-values for each model\n  model_results <- lapply(models, function(model) {\n    ctable <- coef(summary(model))  # Extract coefficients and standard errors\n    p_values <- pnorm(abs(ctable[, \"t value\"]), lower.tail = FALSE) * 2  # Calculate p-values\n    result <- data.frame(Coefficient = ctable[, \"Value\"], `Std. Error` = ctable[, \"Std. Error\"], \n                         `t Value` = ctable[, \"t value\"], `p Value` = p_values)\n    return(result)\n  })\n  \n  # Store results for the current metric\n  regression_results[[metric]] <- model_results\n}\n\n\n# Combine results into a single data frame for easier reporting\nformatted_results <- lapply(names(regression_results), function(metric) {\n  data <- regression_results[[metric]]\n  model_names <- c(#\"Day of Survey\", \n                   # \"Day Before Survey\", \n                   # \"Week Before Survey\", \n                   # \"Month Before Survey\", \n                   # \"3 Months Before\", \n                   # \"6 Months Before\", \n                   \"Pre-Conception\", \n                   \"First Trimester\", \n                   \"Second Trimester\", \n                   \"Third Trimester\", \n                   \"Entire Pregnancy\")\n  data <- lapply(seq_along(data), function(i) cbind(Model = model_names[i], data[[i]]))\n  data <- do.call(rbind, data)\n  cbind(Metric = metric, data)\n})\n\n# Combine all metrics into a single data frame\nfinal_results <- do.call(rbind, formatted_results)\n\n# Convert row names to a column\nfinal_results <- tibble::rownames_to_column(final_results, var = \"regression_part\")\n\noptions(scipen=999)\n\n# Filter out rows with \"low|moderate\" or \"moderate|high1\"\nfiltered_results <- final_results %>%\n  filter(!grepl(\"low\\\\|moderate\", regression_part)) %>%\n  filter(!grepl(\"moderate\\\\|high\", regression_part)) %>%\n  filter(str_detect(regression_part, \"avg_temp\")) %>%\n  \n  # add exponentiated coefficient for intepretation of 1 degree increase in temp\n  mutate(odds_ratio = exp(Coefficient)) %>%\n\n  # add significant indicator\n  mutate(significant = ifelse(p.Value < 0.05, 1, 0)) \n\n\nfiltered_results %>% \n  select(Model, Coefficient, Std..Error, odds_ratio, p.Value) %>%\n  rename(\n    `Model` = Model,\n    `Coefficient` = Coefficient,\n    `Std. Error` = Std..Error,\n    `Odds Ratio` = odds_ratio,\n    `P-Value` = p.Value\n  ) %>%\n  gt() %>%\n  fmt_number(\n    columns = c(`Coefficient`, `Std. Error`, `Odds Ratio`, `P-Value`),\n    decimals = 3\n  ) %>%\n  tab_header(\n    title = \"Ordered Logistic Regression Results\",\n    subtitle = \"Higher WBGT during pre-conception, the first trimester, and the entire pregnancy period as a whole associated with increased likelihood of belonging to a higher stress group.\"\n  ) %>%\n  cols_align(\n    align = \"center\"\n  )\n```\n\n::: {.cell-output-display}\n\n```{=html}\n<div id=\"ogotcepucj\" style=\"padding-left:0px;padding-right:0px;padding-top:10px;padding-bottom:10px;overflow-x:auto;overflow-y:auto;width:auto;height:auto;\">\n<style>#ogotcepucj table {\n  font-family: system-ui, 'Segoe UI', Roboto, Helvetica, Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji', 'Segoe UI Symbol', 'Noto Color Emoji';\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\n#ogotcepucj thead, #ogotcepucj tbody, #ogotcepucj tfoot, #ogotcepucj tr, #ogotcepucj td, #ogotcepucj th {\n  border-style: none;\n}\n\n#ogotcepucj p {\n  margin: 0;\n  padding: 0;\n}\n\n#ogotcepucj .gt_table {\n  display: table;\n  border-collapse: collapse;\n  line-height: normal;\n  margin-left: auto;\n  margin-right: auto;\n  color: #333333;\n  font-size: 16px;\n  font-weight: normal;\n  font-style: normal;\n  background-color: #FFFFFF;\n  width: auto;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #A8A8A8;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #A8A8A8;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_caption {\n  padding-top: 4px;\n  padding-bottom: 4px;\n}\n\n#ogotcepucj .gt_title {\n  color: #333333;\n  font-size: 125%;\n  font-weight: initial;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-color: #FFFFFF;\n  border-bottom-width: 0;\n}\n\n#ogotcepucj .gt_subtitle {\n  color: #333333;\n  font-size: 85%;\n  font-weight: initial;\n  padding-top: 3px;\n  padding-bottom: 5px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-color: #FFFFFF;\n  border-top-width: 0;\n}\n\n#ogotcepucj .gt_heading {\n  background-color: #FFFFFF;\n  text-align: center;\n  border-bottom-color: #FFFFFF;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_bottom_border {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_col_headings {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_col_heading {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 6px;\n  padding-left: 5px;\n  padding-right: 5px;\n  overflow-x: hidden;\n}\n\n#ogotcepucj .gt_column_spanner_outer {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: normal;\n  text-transform: inherit;\n  padding-top: 0;\n  padding-bottom: 0;\n  padding-left: 4px;\n  padding-right: 4px;\n}\n\n#ogotcepucj .gt_column_spanner_outer:first-child {\n  padding-left: 0;\n}\n\n#ogotcepucj .gt_column_spanner_outer:last-child {\n  padding-right: 0;\n}\n\n#ogotcepucj .gt_column_spanner {\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: bottom;\n  padding-top: 5px;\n  padding-bottom: 5px;\n  overflow-x: hidden;\n  display: inline-block;\n  width: 100%;\n}\n\n#ogotcepucj .gt_spanner_row {\n  border-bottom-style: hidden;\n}\n\n#ogotcepucj .gt_group_heading {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  text-align: left;\n}\n\n#ogotcepucj .gt_empty_group_heading {\n  padding: 0.5px;\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  vertical-align: middle;\n}\n\n#ogotcepucj .gt_from_md > :first-child {\n  margin-top: 0;\n}\n\n#ogotcepucj .gt_from_md > :last-child {\n  margin-bottom: 0;\n}\n\n#ogotcepucj .gt_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  margin: 10px;\n  border-top-style: solid;\n  border-top-width: 1px;\n  border-top-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 1px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 1px;\n  border-right-color: #D3D3D3;\n  vertical-align: middle;\n  overflow-x: hidden;\n}\n\n#ogotcepucj .gt_stub {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ogotcepucj .gt_stub_row_group {\n  color: #333333;\n  background-color: #FFFFFF;\n  font-size: 100%;\n  font-weight: initial;\n  text-transform: inherit;\n  border-right-style: solid;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n  padding-left: 5px;\n  padding-right: 5px;\n  vertical-align: top;\n}\n\n#ogotcepucj .gt_row_group_first td {\n  border-top-width: 2px;\n}\n\n#ogotcepucj .gt_row_group_first th {\n  border-top-width: 2px;\n}\n\n#ogotcepucj .gt_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ogotcepucj .gt_first_summary_row {\n  border-top-style: solid;\n  border-top-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_first_summary_row.thick {\n  border-top-width: 2px;\n}\n\n#ogotcepucj .gt_last_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_grand_summary_row {\n  color: #333333;\n  background-color: #FFFFFF;\n  text-transform: inherit;\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ogotcepucj .gt_first_grand_summary_row {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-top-style: double;\n  border-top-width: 6px;\n  border-top-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_last_grand_summary_row_top {\n  padding-top: 8px;\n  padding-bottom: 8px;\n  padding-left: 5px;\n  padding-right: 5px;\n  border-bottom-style: double;\n  border-bottom-width: 6px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_striped {\n  background-color: rgba(128, 128, 128, 0.05);\n}\n\n#ogotcepucj .gt_table_body {\n  border-top-style: solid;\n  border-top-width: 2px;\n  border-top-color: #D3D3D3;\n  border-bottom-style: solid;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_footnotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_footnote {\n  margin: 0px;\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ogotcepucj .gt_sourcenotes {\n  color: #333333;\n  background-color: #FFFFFF;\n  border-bottom-style: none;\n  border-bottom-width: 2px;\n  border-bottom-color: #D3D3D3;\n  border-left-style: none;\n  border-left-width: 2px;\n  border-left-color: #D3D3D3;\n  border-right-style: none;\n  border-right-width: 2px;\n  border-right-color: #D3D3D3;\n}\n\n#ogotcepucj .gt_sourcenote {\n  font-size: 90%;\n  padding-top: 4px;\n  padding-bottom: 4px;\n  padding-left: 5px;\n  padding-right: 5px;\n}\n\n#ogotcepucj .gt_left {\n  text-align: left;\n}\n\n#ogotcepucj .gt_center {\n  text-align: center;\n}\n\n#ogotcepucj .gt_right {\n  text-align: right;\n  font-variant-numeric: tabular-nums;\n}\n\n#ogotcepucj .gt_font_normal {\n  font-weight: normal;\n}\n\n#ogotcepucj .gt_font_bold {\n  font-weight: bold;\n}\n\n#ogotcepucj .gt_font_italic {\n  font-style: italic;\n}\n\n#ogotcepucj .gt_super {\n  font-size: 65%;\n}\n\n#ogotcepucj .gt_footnote_marks {\n  font-size: 75%;\n  vertical-align: 0.4em;\n  position: initial;\n}\n\n#ogotcepucj .gt_asterisk {\n  font-size: 100%;\n  vertical-align: 0;\n}\n\n#ogotcepucj .gt_indent_1 {\n  text-indent: 5px;\n}\n\n#ogotcepucj .gt_indent_2 {\n  text-indent: 10px;\n}\n\n#ogotcepucj .gt_indent_3 {\n  text-indent: 15px;\n}\n\n#ogotcepucj .gt_indent_4 {\n  text-indent: 20px;\n}\n\n#ogotcepucj .gt_indent_5 {\n  text-indent: 25px;\n}\n</style>\n<table class=\"gt_table\" data-quarto-disable-processing=\"false\" data-quarto-bootstrap=\"false\">\n  <thead>\n    <tr class=\"gt_heading\">\n      <td colspan=\"5\" class=\"gt_heading gt_title gt_font_normal\" style>Ordered Logistic Regression Results</td>\n    </tr>\n    <tr class=\"gt_heading\">\n      <td colspan=\"5\" class=\"gt_heading gt_subtitle gt_font_normal gt_bottom_border\" style>Higher WBGT during pre-conception, the first trimester, and the entire pregnancy period as a whole associated with increased likelihood of belonging to a higher stress group.</td>\n    </tr>\n    <tr class=\"gt_col_headings\">\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Model\">Model</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Coefficient\">Coefficient</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Std. Error\">Std. Error</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"Odds Ratio\">Odds Ratio</th>\n      <th class=\"gt_col_heading gt_columns_bottom_border gt_center\" rowspan=\"1\" colspan=\"1\" scope=\"col\" id=\"P-Value\">P-Value</th>\n    </tr>\n  </thead>\n  <tbody class=\"gt_table_body\">\n    <tr><td headers=\"Model\" class=\"gt_row gt_center\">Pre-Conception</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.176</td>\n<td headers=\"Std. Error\" class=\"gt_row gt_center\">0.085</td>\n<td headers=\"Odds Ratio\" class=\"gt_row gt_center\">1.193</td>\n<td headers=\"P-Value\" class=\"gt_row gt_center\">0.038</td></tr>\n    <tr><td headers=\"Model\" class=\"gt_row gt_center\">First Trimester</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.301</td>\n<td headers=\"Std. Error\" class=\"gt_row gt_center\">0.096</td>\n<td headers=\"Odds Ratio\" class=\"gt_row gt_center\">1.351</td>\n<td headers=\"P-Value\" class=\"gt_row gt_center\">0.002</td></tr>\n    <tr><td headers=\"Model\" class=\"gt_row gt_center\">Second Trimester</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.165</td>\n<td headers=\"Std. Error\" class=\"gt_row gt_center\">0.092</td>\n<td headers=\"Odds Ratio\" class=\"gt_row gt_center\">1.179</td>\n<td headers=\"P-Value\" class=\"gt_row gt_center\">0.072</td></tr>\n    <tr><td headers=\"Model\" class=\"gt_row gt_center\">Third Trimester</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">−0.003</td>\n<td headers=\"Std. Error\" class=\"gt_row gt_center\">0.086</td>\n<td headers=\"Odds Ratio\" class=\"gt_row gt_center\">0.997</td>\n<td headers=\"P-Value\" class=\"gt_row gt_center\">0.976</td></tr>\n    <tr><td headers=\"Model\" class=\"gt_row gt_center\">Entire Pregnancy</td>\n<td headers=\"Coefficient\" class=\"gt_row gt_center\">0.443</td>\n<td headers=\"Std. Error\" class=\"gt_row gt_center\">0.153</td>\n<td headers=\"Odds Ratio\" class=\"gt_row gt_center\">1.557</td>\n<td headers=\"P-Value\" class=\"gt_row gt_center\">0.004</td></tr>\n  </tbody>\n  \n  \n</table>\n</div>\n```\n\n:::\n:::\n\n\nThe results indicate that:\n\n-   Again, heat stress during the entire pregnancy is significantly associated with belonging to a higher stress group. A °1C increase in WBGT is associated with a 55.7% increase in the odds of belonging to a higher stress group (p = 0.004).\n\n-   Higher daily maximum WBGT during the preconception period and first trimester is significantly associated with an increased likelihood of belonging to a higher stress group. A 1°C increase in WBGT is linked to a 19.3% increase in the odds of higher stress during pre-conception (p = 0.038) and a 35.1% increase during the first trimester (p = 0.002).\n\n-   The second trimester showed a positive association between WBGT and Sum NDS Category, but the effect was not statistically significant.\n\n-   The third trimester showed no association between WBGT and Sum NDS Category, suggesting that temperatures closer to the survey date are less strongly linked to stress levels.\n\n## Exploring the relationship between temperature and sleep quantity\n\nA linear regression model was employed to examine the association between average WBGT and total sleep time (TST), providing insights into the impact of heat on sleep quantity.\n\n\n::: {.cell}\n\n```{.r .cell-code}\nactigraphy_with_temp <- actigraphy_simple_full %>%\n  rowwise() %>%  # Process each row individually\n  mutate(\n    avg_temp = WBGT_daily_max %>%\n      filter(\n        community == vname,  # Match the community\n        date >= Start.Date & date <= End.Date  # Filter by date range\n      ) %>%\n      summarise(mean_temp = mean(max_wbgt, na.rm = TRUE)) %>%  # Calculate mean temperature between the start date and end date (for just one night study, this would be a two day average)\n      pull(mean_temp)  # Extract the mean value\n  ) %>%\n  ungroup() %>% # Remove row-wise grouping \n  filter(!is.na(avg_temp)) # remove NA community or participants where no temp data for community\n\n# After removing 7 participants who did not have a community that matches the communities in the temperature data, we are left with 177 participants. \n\n\n\nactigraphy_with_temp_no_outlier <- actigraphy_with_temp %>%\n  filter(avg_temp > 20) # One temperature recording (18.7) is over 4 degrees colder than the next coolest temperature (22.9) -- this point was found to be extremely high leverage as well as an outlier. There is not evidence that this is an erroneous reading, but for the purposes of creating a reliable model, the value was removed. \n\n\n# Fit a linear model\nsleep_time_model_no_outlier <- lm(Sleep.Time..mins. ~ avg_temp, data = actigraphy_with_temp_no_outlier)\n\n\n# Extract model summary statistics\nsummary_sleep_time <- summary(sleep_time_model_no_outlier)\nslope <- round(coef(summary_sleep_time)[\"avg_temp\", \"Estimate\"], 2)\np_value <- signif(coef(summary_sleep_time)[\"avg_temp\", \"Pr(>|t|)\"], 2)\nr_squared <- round(summary_sleep_time$r.squared, 2)\nn <- nrow(actigraphy_with_temp_no_outlier)\n\n# Create the plot\nactigraphy_with_temp_no_outlier %>%\n  ggplot(aes(x = avg_temp, y = Sleep.Time..mins.)) +\n  geom_point(alpha = 0.6) + \n  geom_smooth(method = \"lm\") +\n  theme_classic(base_size = 15) + # Increase base text size\n  labs(\n    x = \"Average Daily Maximum WBGT Over Study Period\",\n    y = \"Total Sleep Time (mins)\",\n    title = \"Higher Temperatures Associated with Reduced \\nTotal Sleep Time\" # \n  ) +\n  theme(\n    plot.title = element_text(size = 16), # Adjust title size and style\n    axis.title.x = element_text(size = 14), # Adjust x-axis label size\n    axis.title.y = element_text(size = 14), # Adjust y-axis label size\n    axis.text = element_text(size = 12) # Adjust axis text size\n  ) +\n  annotate(\n    \"text\",\n    x = min(actigraphy_with_temp_no_outlier$avg_temp) + 0.5, \n    y = 220, \n    label = paste(\n      \"Slope =\", slope, \n      \"\\nP =\", p_value,\n      \"\\nR² =\", r_squared, \n      \"\\nN =\", n\n    ),\n    hjust = 0.4, \n    vjust = 0.5, \n    size = 4\n  )\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-4-1.png){width=672}\n:::\n:::\n\n\nA highly significant negative association is observed, with a slope of -13.75 (p \\< 0.001), indicating that for each degree increase in the average maximum WBGT, our model predicts that total sleep time decreases by approximately 14 minutes. These findings suggest that higher temperatures during the study period are associated with reduced total sleep duration, which may reflect the challenges of maintaining optimal sleep in warmer conditions.\n\n## Key Takeaways\n\nIt’s important to note these findings are from early-stage analyses using observational data. While the results strongly hint at an association between heat exposure and mental health outcomes, further work is needed to definitively establish causality. That said, here are a few takeaways I'd like to highlight.\n\n-   **Heat Stress and Mental Health:\\\n    **Across multiple modeling approaches (Distributed Lag Models, Linear Regression, and Ordered Logistic Regression), the findings consistently point toward higher heat exposures (measured via WBGT) being associated with elevated stress levels among pregnant women in rural Ghana.\n\n-   **Critical Windows During Pregnancy:\\\n    **Exposure to high temperatures early in pregnancy—especially during the first trimester—had the strongest association with negative mental health outcomes. This suggests that heat stress may have a greater impact in the early stages of gestation, with its effects diminishing later in pregnancy. If these findings hold, interventions like cooling strategies may be most valuable during the first trimester, when the risk appears to be highest.\n\n-   **Sleep Disruption:\\\n    **Preliminary linear regressions on actigraphy data suggest a significant negative relationship between temperature and total sleep time, with about 14 fewer minutes of sleep predicted for each 1°C increase in average maximum WBGT. This aligns with existing literature on heat-related sleep disturbances and may partially explain how temperature influences stress pathways.\n\n## Next Steps\n\nI am now starting to work on diving deeper into the causal framework through mediation analysis in R. This analysis aims to tease out how various mechanisms—such as changes in sleep, underlying physiological processes, and additional environmental factors (e.g. air pollution)—may mediate the relationship between temperature and maternal mental health.\n\n## References\n\n\\[1\\] Dagher, R. K., Bruckheim, H. E., Colpe, L. J., Edwards, E., & White, D. B. (2021). Perinatal Depression: Challenges and Opportunities. Journal of Women’s Health, 30(2), 154–159. <https://doi.org/10.1089/jwh.2020.8862>\n\n\\[2\\] WHO-Ghana. Strengthening Maternal Mental Health in Ghana - Policy Brief \\[Internet\\]. 2024. Available from: <https://www.afro.who.int/sites/default/files/2024-02/Policy%20brief%20-%20Strengthening%20Maternal%20Mental%20Health%20in%20Ghana.pdf>\n\n\\[3\\] McCauley, M., Brown, A., Ofosu, B., & van den Broek, N. (2019). “I just wish it becomes part of routine care”: Healthcare providers’ knowledge, attitudes and perceptions of screening for maternal mental health during and after pregnancy: a qualitative study. BMC Psychiatry, 19(1), 279. https://doi.org/10.1186/s12888-019-2261-x\n\n\\[4\\] Thompson, R., Hornigold, R., Page, L., & Waite, T. (2018). Associations between high ambient temperatures and heat waves with mental health outcomes: A systematic review. Public Health, 161, 171–191. https://doi.org/10.1016/j.puhe.2018.06.008\n\n\\[5\\] Fang, W., Liu, L., Yin, B., Ke, L., Su, Y., Liu, F., Ma, X., & Di, Q. (2023). Heat exposure intervention, anxiety level, and multi-omic profiles: A randomized crossover study. Environment International, 181, 108247. https://doi.org/10.1016/j.envint.2023.108247\n\n## Appendix\n\n#### **Distributed Lag Model for PSS**\n\nPredictions were generated relative to the median temperature (27.3°C) to evaluate how temperature and lagged exposure impact perceived stress levels. Due to the limited number of recordings below 24°C, and given the grant’s focus on heat exposure, I restricted the analysis to higher temperature ranges.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# DLMs\n\n## SET UP THE DATA FOR DLNM\n\n# Function to process temperature data for the selected metric\nprocess_temperature_data <- function(era5_data, metric) {\n  era5_data %>%\n    select(community, date, !!sym(metric)) %>%\n    rename(temp_metric = !!sym(metric)) %>%\n    distinct()\n}\n\n# Function to create temperature lags\ncreate_temperature_lags <- function(stress_data, temp_data) {\n  stress_data %>%\n    select(mstudyid, vname, survey_date) %>%\n    mutate(start_date = survey_date - 270) %>%\n    rowwise() %>%\n    mutate(lag_dates = list(seq.Date(start_date, survey_date, by = \"day\"))) %>%\n    unnest(lag_dates) %>%\n    rename(date = lag_dates) %>%\n    left_join(temp_data, by = c(\"vname\" = \"community\", \"date\" = \"date\"))\n}\n\n# Process temp data\ntemp_data_clean <- process_temperature_data(era5_data = era5, metric = \"max_wbgt\")\n\n# created lagged data set\ntemperature_lags <- create_temperature_lags(stress_data = pss_simple, temp_data = temp_data_clean)\n\n# create wide-format lagged data\ntemperature_lags_wide <- temperature_lags %>%\n  mutate(lag = as.numeric(survey_date - date)) %>%\n  pivot_wider(names_from = lag, values_from = temp_metric, names_prefix = \"temp_lag_\") %>%\n  select(mstudyid, survey_date, starts_with(\"temp_lag_\")) %>%\n  group_by(mstudyid, survey_date) %>%\n  reframe(across(starts_with(\"temp_lag_\"), ~ first(na.omit(.)), .names = \"{col}\")) %>%\n  left_join(pss_simple %>% select(mstudyid, survey_date, PSS4), by = c(\"mstudyid\", \"survey_date\")) %>%\n  filter(!is.na(temp_lag_0)) # Remove rows without lag 0 data\n\n# create temperature matrix for cross basis\ntemp_data_matrix <- temperature_lags_wide %>%\n  select(starts_with(\"temp_lag_\")) %>%\n  as.matrix()\n\n## SET UP PARAMS\n\n# predictor DLNM model parameters -- captures the relationship between the predictor variable (temp) and the outcome\nvar_arg = list(fun = \"bs\", df = 4, degree = 3) # smooth cubic polynomial (degree = 3) between the boundary knots (no internal knots)\n\n# lag DLNM model parameters -- captures the lagged effects of the predictor variable (temp) over time.\nlag_arg = list(fun = \"bs\", df = 4, degree = 3) # smooth cubic polynomial (degree = 3) between the boundary knots (no internal knots)\n\n# cross-basis matrix for DLNM\ncb = crossbasis(temp_data_matrix, lag = c(1, ncol(temp_data_matrix)), argvar = var_arg, arglag = lag_arg) # basis for the predictor and lag \n\n\n\n\n## FIT MODEL\nmodel = glm(formula = PSS4 ~ cb, data = temperature_lags_wide, family = \"gaussian\") # stress scores continuous and normally dist, so gaussian family appropriate\n\n\n# GET PREDICTIONS (in reference to median temp)\ntemp_median <- round(median(as.vector(temp_data_matrix)), 1) # centering value (median). \npss_temp_median <- temp_median\n\n# generate predictions for a DLNM, set centering value as the median of all temperatures\ncpred = crosspred(cb, \n                  model, \n                  ci.level = 0.95, # 95% confidence intervals calculated around predicted values\n                  cen = temp_median, # predictions are relative to this baseline temperature.\n                  by = 0.1) # predictions are generated at intervals of 0.1 units of temperature\n\n\n# plot contour map of 3d plot\nplot(\n  cpred, \n  \"contour\", \n  main = paste0(\"Effects of Temperature and Lag on PSS Relative to \\nMedian Temperature (\", pss_temp_median, \"\\u00B0 C)\"), \n  xlab = \"Temperature (°C)\", \n  ylab = \"Lag (days)\", \n  key.title = title(main = \"Change \\nin PSS\", cex.main = 0.8)\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Examine lag effect at top percentile \ntemp_99.9pct = round(quantile(as.vector(temp_data_matrix), 0.999), 1) # third quartile of temperature\ntemp_99.9pct = as.numeric(temp_99.9pct)\npss_temp_99.9pct <- temp_99.9pct\n\n\n## Customized plot of effect at top percentile \nplot_var = temp_99.9pct\nplot_var_matfit = cpred$matfit[rownames(cpred$matfit) == plot_var, ]\nnames(plot_var_matfit) = sub(\"lag\", \"\", names(plot_var_matfit))\nplot_var_matlow = cpred$matlow[rownames(cpred$matlow) == plot_var, ]\nnames(plot_var_matlow) = sub(\"lag\", \"\", names(plot_var_matlow))\nplot_var_mathigh = cpred$mathigh[rownames(cpred$mathigh) == plot_var, ]\nnames(plot_var_mathigh) = sub(\"lag\", \"\", names(plot_var_mathigh))\n\nplot(x = names(plot_var_matfit),\n       y = plot_var_matfit,\n       xlab = \"Lag (days)\", ylab = \"Effect on Perceived Stress Score (PSS)\",\n       main = paste0(\"At the 99.9th Temperature Percentile (\", temp_99.9pct,\"\\u00B0 C), \\nthe Effect of Temperature is Signficant for Lags 110-158\"),\n       type = \"l\", lwd = 2, ylim = c(min(plot_var_matlow), max(plot_var_mathigh)))  # plot of effect size at exposure/variable relative to median 26\n\npolygon(x = c(names(plot_var_mathigh),\n              rev(names(plot_var_matlow))),\n        y = c(plot_var_mathigh,\n                rev(plot_var_matlow)),\n        col = rgb(0, 0, 0, alpha = 0.2), border = NA)  # add confidence interval of OR at exposure/variable = 27.8\n\nabline(h = 0, lty = 2) # add line at effect size = 0\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-5-2.png){width=672}\n:::\n:::\n\n\nThe plots above illustrate the association between temperature and PSS across various lag periods. Compared to the median temperature (27.3°C), extreme heat exposure (above 31°C) is associated with higher stress scores, particularly 4–5 months before the survey date. However, at both longer (9 months before) and shorter lag periods (a few weeks before the survey), these extremely high temperatures show a slight but non-significant mitigating effect, with stress scores decreasing relative to the median temperature.\\\n\n#### **Distributed Lag Model for Sum NDS**\n\nPredictions were generated relative to the median temperature (27.4°C) to assess how temperature and lagged exposure impact resilience, as measured by Sum NDS Category. As with the PSS analysis, the small number of recordings below 24°C and the grant’s focus on heat exposure led me to concentrate exclusively on higher temperatures.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Function to process temperature data for the selected metric\nprocess_temperature_data <- function(era5_data, metric) {\n  era5_data %>%\n    select(community, date, !!sym(metric)) %>%\n    rename(temp_metric = !!sym(metric)) %>%\n    distinct()\n}\n\n# Function to create temperature lags\ncreate_temperature_lags <- function(stress_data, temp_data) {\n  stress_data %>%\n    select(mstudyid, vname, survey_date) %>%\n    mutate(start_date = survey_date - 270) %>%\n    rowwise() %>%\n    mutate(lag_dates = list(seq.Date(start_date, survey_date, by = \"day\"))) %>%\n    unnest(lag_dates) %>%\n    rename(date = lag_dates) %>%\n    left_join(temp_data, by = c(\"vname\" = \"community\", \"date\" = \"date\"))\n}\n\n# Process temp data\ntemp_data_clean <- process_temperature_data(era5_data = era5, metric = \"max_wbgt\")\n\n# created lagged data set\ntemperature_lags <- create_temperature_lags(stress_data = crisis_simple, temp_data = temp_data_clean)\n\n# create wide-format lagged data\ntemperature_lags_wide <- temperature_lags %>%\n  mutate(lag = as.numeric(survey_date - date)) %>%\n  pivot_wider(names_from = lag, values_from = temp_metric, names_prefix = \"temp_lag_\") %>%\n  select(mstudyid, survey_date, starts_with(\"temp_lag_\")) %>%\n  group_by(mstudyid, survey_date) %>%\n  reframe(across(starts_with(\"temp_lag_\"), ~ first(na.omit(.)), .names = \"{col}\")) %>%\n  left_join(crisis_simple %>% select(mstudyid, survey_date, sum_nds_category), by = c(\"mstudyid\", \"survey_date\")) %>%\n  filter(!is.na(temp_lag_0)) # Remove rows without lag 0 data\n\n# create temperature matrix for cross basis\ntemp_data_matrix <- temperature_lags_wide %>%\n  select(starts_with(\"temp_lag_\")) %>%\n  as.matrix()\n\n\n\n# set up DLNM model parameters, fit model, and get predictions\n\n## SET UP PARAMS\n\n# predictor DLNM model parameters -- captures the relationship between the predictor variable (temp) and the outcome\nvar_arg = list(fun = \"bs\", df = 4, degree = 3) # smooth cubic polynomial (degree = 3) between the boundary knots (no internal knots)\n\n# lag DLNM model parameters -- captures the lagged effects of the predictor variable (temp) over time.\nlag_arg = list(fun = \"bs\", df = 4, degree = 3) # smooth cubic polynomial (degree = 3) between the boundary knots (no internal knots)\n\n# cross-basis matrix for DLNM\ncb = crossbasis(temp_data_matrix, lag = c(1, ncol(temp_data_matrix)), argvar = var_arg, arglag = lag_arg) # basis for the predictor and lag \n\n# ordered logistic regression model\nmodel_polr <- polr(\n  formula = sum_nds_category ~ cb,\n  data = temperature_lags_wide,\n  method = \"logistic\" \n)\n\n\n\n# GET PREDICTIONS (in reference to median temp)\ntemp_median <- round(median(as.vector(temp_data_matrix)), 1) # centering value (median). \ncrysis_temp_median <- temp_median\n\n# generate predictions for a DLNM, set centering value as the median of all temperatures\ncpred = crosspred(cb, \n                  model_polr, \n                  ci.level = 0.95, # 95% confidence intervals calculated around predicted values\n                  cen = temp_median, # predictions are relative to this baseline temperature.\n                  by = 0.1) # predictions are generated at intervals of 0.1 units of temperature\n\n\n# plot contour map of 3d plot\nplot(\n  cpred, \n  \"contour\", \n  main = paste0(\"Effects of Temperature and Lag on Log Odds \\nof Higher Stress Category Relative \\nto Median Temperature (\",temp_median, \"°C)\"), \n  xlab = \"Temperature (°C)\", \n  ylab = \"Lag (days)\", \n  key.title = title(main = \"Change in \\nLog Odds\", cex.main = 0.8)\n)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n\n```{.r .cell-code}\n# Examine lag effect at top percentile \ntemp_top_pct = round(quantile(as.vector(temp_data_matrix), 0.99), 1) # third quartile of temperature\ntemp_top_pct = as.numeric(temp_top_pct)\ncrysis_temp_top_pct = temp_top_pct\n\n\n## Customized plot of effect at top percentile \nplot_var = temp_top_pct\nplot_var_matfit = cpred$matfit[rownames(cpred$matfit) == plot_var, ]\nnames(plot_var_matfit) = sub(\"lag\", \"\", names(plot_var_matfit))\nplot_var_matlow = cpred$matlow[rownames(cpred$matlow) == plot_var, ]\nnames(plot_var_matlow) = sub(\"lag\", \"\", names(plot_var_matlow))\nplot_var_mathigh = cpred$mathigh[rownames(cpred$mathigh) == plot_var, ]\nnames(plot_var_mathigh) = sub(\"lag\", \"\", names(plot_var_mathigh))\n\nplot(\n  x = names(plot_var_matfit),\n  y = plot_var_matfit,\n  xlab = \"Lag (days)\", \n  ylab = \"Change in Log Odds of Higher Stress Category\",\n  main = paste0(\"Compared to the Median (\", temp_median, \"\\u00B0 C), the Effect of Temperature \\nat the 99th Percentile (\", temp_top_pct,\"\\u00B0 C) is Signficant for Lags 134-247\"),\n  type = \"l\", \n  lwd = 2, \n  ylim = c(min(plot_var_matlow), max(plot_var_mathigh))\n)\n\n# Add shaded confidence intervals\npolygon(\n  x = c(names(plot_var_mathigh), rev(names(plot_var_matlow))),\n  y = c(plot_var_mathigh, rev(plot_var_matlow)),\n  col = rgb(0, 0, 0, alpha = 0.2), \n  border = NA\n)\n\n# Add horizontal line at 0\nabline(h = 0, lty = 2)\n```\n\n::: {.cell-output-display}\n![](index_files/figure-html/unnamed-chunk-6-2.png){width=672}\n:::\n:::\n\n\nThe plots above illustrate the relationship between temperature and Sum NDS Category over various lag periods. Compared to the median temperature (27.4°C), extreme heat exposure (above 30°C) is associated with higher stress scores, particularly 5–8 months before the survey date.\n",
    "supporting": [
      "index_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}